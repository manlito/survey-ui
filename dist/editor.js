!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.OverResponse=t():(e.OverResponse=e.OverResponse||{},e.OverResponse.editor=t())}(self,(function(){return(()=>{"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{startSurveyEditor:()=>H});const i="Unlimited",n="Click to edit",o="Add Option",a="Other",l="Please specify: ",s="Yes",d="No",r="Female",c="Male",h="True",u="False",p="Attribute / Subject",m="Don't Care",v="Neutral",f="Very Important",I={UNLIMITED:"Unlimited",DONE:"Done",SAVE:"Save",DISCARD:"Discard",DRAGGING_NEW:"Drag this to create a new <b>%s</b> item",DRAGGING_EXISTING:"Drag this to move or swap <b>%s</b> item",Dropdown:"Dropdown",RadioText:"RadioText",RadioImage:"RadioImage",RadioVideo:"RadioVideo",RadioEmbed:"RadioEmbed",RadioHTML:"RadioHTML",ListText:"ListText",ListImage:"ListImage",ListVideo:"ListVideo",ListEmbed:"ListEmbed",ListHTML:"ListHTML",Dropdown_DETAILED:"Dropdown Selector",RadioText_DETAILED:"Radio Choice with Text",RadioImage_DETAILED:"Radio Choice with Images",RadioVideo_DETAILED:"Radio Choice with Video",RadioEmbed_DETAILED:"Radio Choice with Embedded Content",RadioHTML_DETAILED:"Radio Choice with custom HTML",ListText_DETAILED:"List Choice with Text",ListImage_DETAILED:"List Choice with Images",ListVideo_DETAILED:"List Choice with Video",ListEmbed_DETAILED:"List Choice with Embedded Content",ListHTML_DETAILED:"List Choice with custom HTML",TIP_SURVEY_NAME:"Define an internal name. It <b>won't</b> be exposed to respondants.",TIP_CLICK_TO_VIEW_SUBITEMS:"Click to view subitems",TIP_CLICK_TO_INSERT:"Click to <b>insert</b> at the end",IMAGE_REMOVE:"Replace",VIDEO_REMOVE:"Replace",VIDEO_URL:"URL",THEME_Red:"Red",THEME_Gray:"Gray",THEME_Black:"Black"};function b(e){var t=e;this.randomizeArray=function(e){var t,i,n,o=e.length;if(0===o)return!1;for(;--o;)t=Math.floor(Math.random()*(o+1)),i=e[o],n=e[t],e[o]=n,e[t]=i},this.randomId=function(){return this.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},this.guid=function(){return this.S4()+""+this.S4()+this.S4()+this.S4()},this.guid()},this.tr=function(e){for(var t=Array.prototype.slice.call(arguments,0),i=t.slice(1),n=0;n<i.length;++n)e=e.replace(/\%s/i,i[n]);return e},this.c=function(e){"undefined"!=typeof console&&void 0!==console.log&&console.log(e)},this.console=function(e){this.show=function(e){t.cookie("ORShowDebug",e,{expires:30,path:"/"})},"string"==typeof e&&(e={text:e});var i,n,o,a=t.extend({hidden:"true"!==t.cookie("ORShowDebug"),type:"Notice"},e);if(0==t("#Console").length){i=t('<div id="Console"><div class="clearfix"><div class="btn-group pull-right"></div></div></div>').appendTo("body"),t('<button type="button" class="btn btn-default">Clean</button>').appendTo(i.find(".btn-group")).on({click:function(e){n.empty()}}),(o=t('<button type="button" class="btn btn-default">Close</button>').appendTo(i.find(".btn-group"))).on({click:function(e){i.fadeOut("fast")}}),t('<button type="button" class="btn btn-danger">Disable</button>').prependTo(i.find(".btn-group")).on({click:function(e){t.cookie("ORShowDebug",!1),o.trigger("click")}});var l=t('<div class="ConsoleArea"></div>').appendTo(i);n=t('<div class="TextArea"></div>').appendTo(l);var s=t('<div class="btn-group"></div>').appendTo(i);t('<button type="button" class="btn btn-default">Send Report</button>').appendTo(s)}else i=t("#Console");a.hidden?i.hide():i.fadeIn("fast"),i.find(".TextArea").prepend("<div>"+a.text+"</div>")},this.objectSize=function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i},this.stopPropagation=function(e){e.stopPropagation()},this.documentClick=function(e){t(document).trigger("click")},this.areArraysEqual=function(e,i){return 0==t(e).not(i).length&&0==t(i).not(e).length}}function S(e,t){var o=e,a=this;o(window).on({"click.ORBaseUI":function(e){0==o(e.target).closest(".uiDropDown, .ORLayoutLeft, .ORLayoutRight").length&&o(".uiGeneric").trigger("ORHide")}}),this.base=function(e){var i=o.extend({id:t.randomId(),toolbarId:"NotAvailable",container:void 0,label:"",suffix:"",description:"Description of the command",command:"javascript:void(0)",enabled:!0,positionX:void 0,positionY:void 0,labelWidth:0,width:0,height:0,layout:"Bottom",class:void 0,events:{valueSet:function(){}}},e);this.events=i.events,this.id=i.id;var n,a="";a+='<div class="UiItem" id="'+i.id+'">',""!=i.label&&(a+='<div class="Label">'+i.label+"</div>"),a+='<div class="ORInput"></div>',""!=i.suffix&&(a+='<div class="Suffix">'+i.suffix+"</div>"),a+='<div style="clear: both;"></div>',a+="</div>",n=null!=i.container?o(a).appendTo(i.container):o(a).appendTo("#"+i.toolbarId+" .Fields"),null!=i.class&&n.addClass(i.class),0!=i.labelWidth&&n.find(".Label").width(i.labelWidth+"em"),null==i.positionX&&null==i.positionY||n.css("position","absolute"),null!=i.positionX&&n.css("left",i.positionX),null!=i.positionY&&n.css("top",i.positionY),this.item=n,this.getItemId=function(){return this.id},this.getValue=function(){return 0},this.setValue=function(){},this.reset=function(){t.console({text:"Base - Reset Not implemented"})},this.activate=function(){},this.deactivate=function(){},void 0!==i.value&&this.setValue(i.value,{skipEvents:!0})},this.tooltip=function(e){e=o.extend({container:o("body"),position:"right",text:"OverResponse Help Tooltip",monitorInput:!1,offset:3,delay:500},e),this.showTip=function(i){var n={of:e.container};if("mouse"!=e.position){switch(e.position){case"top":n.my="center bottom",n.at="center top",n.offset="0 -"+e.offset;break;case"mouse":n.my="center bottom",n.at="center top",n.offset="0 -"+e.offset;default:n.my="left center",n.at="right center"}e.container.is("input")?t.tip.stop(!0,!0).show().position(n).hide().fadeIn("normal"):e.container.queue((function(i){t.tip.stop(!0,!0).delay(e.delay).queue((function(e){o(this).show().position(n).hide(),e()})).fadeIn("normal"),i()}))}else t.tip.stop(!0,!0).css({top:mousePosition.y,left:mousePosition.x}).fadeIn("normal")},this.hideTip=function(i){(!e.monitorInput||e.monitorInput&&!e.container.find("input").is(":focus"))&&t.tip.stop(!0,!0).fadeOut("fast")};var t=this;this.tip=o('<div class="ToolTip"></div>').appendTo("body"),this.tipContent=o('<div class="TipContent">'+e.text+"</div>").appendTo(this.tip),e.container.is("input")?e.container.on({focus:t.showTip,blur:t.hideTip}):(t.tip.addClass("NoInput"),e.container.on({mouseenter:t.showTip,mouseleave:t.hideTip}),e.monitorInput&&(e.container.find("input").on({focus:t.showTip,blur:t.hideTip}),o("body").on("click",t.hideTip)),e.container.on("click",t.hideTip))},this.button=function(e){o.extend(this,new a.base(e));var t=o.extend({id:"NotAvailable",toolbarId:"NotAvailable",title:"",text:"",description:"Description of the command",command:function(){},href:"",enabled:!0,horizontal:!0,positionX:"5px",positionY:"10px",width:0,height:0,enableIcon:!0,texturePositionX:0,texturePositionY:0},e),i=void 0,n=this.item.find(".ORInput"),l={click:t.command};this.setEnabled=function(e){i.find(".Icon").css("background-position",t.texturePositionX-(e?0:50)+"px "+t.texturePositionY+"px"),e?(i.parent().on(l),i.addClass("Enabled")):(i.parent().off(l),i.removeClass("Enabled"))},""==t.title&&(t.title=t.text);var s="";s+='<div class="" style="width: 100%; height: 100%;">',s+='<a class="Button '+(t.enabled?"Enabled ":"")+(1==t.horizontal?"Horizontal":"Vertical")+'" '+(""!=t.href?'href="'+t.href+'"':"")+">",t.enableIcon&&(s+='<div class="Icon ORFontIcon Iconset"></div>'),""!=t.text&&(s+='<div class="Label">'+t.text+"</div>"),i=o(s+="</a></div>").appendTo(n.addClass("ButtonItem")),0!==t.width&&n.css("width",t.width),0!==t.height&&n.css("height",t.height),i.find(".Icon").css("background-position",t.texturePositionX-(t.enabled?0:50)+"px "+t.texturePositionY+"px"),t.enabled&&i.parent().on(l),i.find(".Button").css("width","100%"),0==t.horizontal&&i.find(".Button").css("height","100%")},this.dropDown=function(e){var i=this;o.extend(this,new a.base(e)),e=o.extend({defaultLabel:n},e),this.value="",this.collapsed=!0,this.createOption=function(e){var t=o.extend({label:n,value:"",selected:!1},e),a='<li class="Option">  <div class="OptionContent Rounded8px">    <div class="Legend">'+t.label+"</div>  </div></li>";return o(a).appendTo(this.optionsContainer.children("ul")).on({click:i.optionClickEvent}).data({label:t.label,value:t.value})},this.reset=function(){i.value=void 0,i.currentContainer.children(".text").html(e.defaultLabel)},this.optionClickEvent=function(e){i.setValue(o(this).data("label")),i.collapse(),i.events.valueSet({value:i.value,caller:i.currentContainer,relatedItemId:i.getItemId()})},this.setValue=function(e){i.value=e,i.currentContainer.children(".text").html(e)},this.getValue=function(){return i.value},this.activate=function(){i.expand()},this.deactivate=function(){i.collapse()},this.expand=function(){i.optionsContainer.css({top:d.height(),transform:"scaleY(1)"}),i.currentContainer.addClass("selected"),i.collapsed=!1},this.collapse=function(){i.currentContainer.removeClass("selected"),i.optionsContainer.css({transform:"scaleY(0)"}),i.collapsed=!0},this.toggleCollapse=function(){i.collapsed?i.expand():i.collapse()};var l=o.extend({type:"Notification",options:[{label:"Sample Option A",value:0},{label:"Sample Option B",value:1},{label:"Sample Option C",value:2}],selectedOption:0,onSelect:void 0,randomize:!1,editOptions:{enableSorting:!0}},e),s=this.item.children(".ORInput"),d=o('<div class="uiDropDown uiMultiOption uiGeneric"></div>').appendTo(s);this.currentContainer=d,o('<div class="text">'+e.defaultLabel+"</div>").appendTo(d),o('<div class="arrow"></div>').appendTo(d),this.optionsContainer=o('<div class="Options"><ul></ul></div>').appendTo(d),this.optionsContainer.on({click:function(e){e.stopPropagation()},mousedown:function(e){e.stopPropagation()}}),this.currentContainer.on("click",(function(t){i.toggleCollapse(),void 0!==e.events.activate&&e.events.activate(i.currentContainer),void 0!==e.containerClickCommand&&e.containerClickCommand()})).on("ORHide",(function(e){i.collapse()})),l.randomize&&t.randomizeArray(l.options),o.each(l.options,(function(e,t){i.createOption({label:t.label,value:t.value})})),d.on({mouseenter:function(){o(this).addClass("hover")},mouseleave:function(){o(this).removeClass("hover")}})},this.listChoice=function(e){var i=this;e=o.extend({type:"RadioText",randomize:!1,multiSelect:!1,other:{show:!1}},e),this.type=e.type,this.parentType="Radio",this.multiSelect=e.multiSelect,e.type.match(/List/i)?this.parentType="List":e.type.match(/Binary/i)&&(this.parentType="Binary"),o.extend(this,new a.base(e)),this.value="",this.createOption=function(e){var t=o.extend({label:n,value:"",extra:"",selected:!1,other:{show:!1}},e),l='<div class="Legend">'+t.label+"</div>";"RadioImage"==i.type||"ListImage"==i.type?l='<div class="Image"><img src="'+t.extra+'"></div>'+l:"RadioVideo"!=i.type&&"ListVideo"!=i.type||(l='<div class="Video">'+("YouTube"===t.extra[0]?'<iframe width="320" height="180" src="http://www.youtube.com/embed/'+t.extra[1]+'?rel=0" frameborder="0" allowfullscreen></iframe>':'<iframe src="http://player.vimeo.com/video/'+t.extra[1]+'" width="320" height="180" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>')+"</div>"+l);var s='<li class="Option '+(t.other.show?" Other":"")+'">  <div class="OptionContent Rounded8px">    <div class="CellCheck"><div class="CheckMark ORFontIcon"></div></div>    <div class="CellLabel">'+l+"</div>"+(t.other.show?'    <div class="OtherInput"></div>':"")+"  </div></li>",d=this.optionsContainer.children("ul").children("li").last(),r=o(d).hasClass("OtherOption")?d.prev():d,c=(d.length>0?o(s).insertAfter(r):o(s).appendTo(this.optionsContainer.children("ul"))).on({click:i.optionClickEvent}).data({label:t.label,value:t.value,extra:t.extra});return t.other.show&&new a.input({container:c.find(".OtherInput"),label:t.other.hint}),c},this.optionClickEvent=function(n){n.stopPropagation(),e.multiSelect?o(this).toggleClass("Selected"):(i.setValue(o(this).data("label")),i.optionsContainer.children("ul").children("li").not(this).removeClass("Selected"),o(this).addClass("Selected"));var a=i.getValue();void 0!==i.events.activate&&i.events.activate(i.currentContainer),t.console("currentItem.type "+i.type),i.events.valueSet({value:a,caller:i.currentContainer,relatedItemId:i.getItemId(),remainInItem:/^List/.test(i.type)&&"ListCheck"!=i.type})},this.getValue=function(){if(e.multiSelect&&"ListCheck"==i.type)return i.optionsContainer.children("ul").children().first().hasClass("Selected")?"On":"";var t=i.optionsContainer.children("ul").children("li.Selected").get().map((function(e,t){return o(e).find(".Legend").first().text()}));return i.multiSelect?t:0==t.length?"":t[0]},this.reset=function(){i.optionsContainer.children("ul").children("li").each((function(){o(this).removeClass("Selected")}))},this.setValue=function(e){i.value=e,i.currentContainer.children(".text").html(e)},this.setOther=function(t){t&&"Radio"==i.parentType&&i.createOption({label:e.other.label,other:e.other})};var l=o.extend({type:"Notification",selectedOption:0,onSelect:void 0},e),p=this.item.children(".ORInput"),m=o('<div class="uiRadioChoice uiMultiOption uiGeneric ui'+this.parentType+" ui"+this.type+'"></div>').appendTo(p);this.currentContainer=m,this.optionsContainer=o('<div class="Options '+(0==e.showIcon?"IconLess":"")+'"><ul></ul></div>').appendTo(m),"Binary"==this.parentType&&(l.options=[],"BinaryYesNo"==e.type?(l.options.push({label:'<div class="Icon ORFontIcon OptionYes"></div><div class="IconText">'+s+"</div>",Value:"Yes"}),l.options.push({label:'<div class="Icon ORFontIcon OptionNo"></div><div class="IconText">'+d+"</div>",Value:"No"})):"BinaryGender"==e.type?(l.options.push({label:'<div class="Icon ORFontIcon OptionFemale"></div><div class="IconText">'+r+"</div>",Value:"Female"}),l.options.push({label:'<div class="Icon ORFontIcon OptionMale"></div><div class="IconText">'+c+"</div>",Value:"Male"})):"BinaryTrueFalse"==e.type&&(l.options.push({label:'<div class="Icon ORFontIcon OptionTrue"></div><div class="IconText">'+h+"</div>",Value:"True"}),l.options.push({label:'<div class="Icon ORFontIcon OptionFalse"></div><div class="IconText">'+u+"</div>",Value:"False"}))),l.randomize&&t.randomizeArray(l.options),o.each(l.options,(function(e,t){i.createOption({label:t.label,value:t.value,extra:t.extra})})),this.setOther(e.other.show)},this.rank=function(e){var i=this;e=o.extend({type:"RadioText",options:[],randomize:!1,headerStyle:"TwoLabels",headerLabels:"",headerCategory:p,levels:5},e),this.options=e,this.type=this.options.type,o.extend(this,new a.base(e)),this.value="",this.createOption=function(e){var t=o.extend({label:n,value:"",extra:"",selected:!1},e),a='<div class="Legend">'+t.label+"</div>";"RateRadioImage"==i.type?a='<div class="Image"><img src="'+t.extra+'"></div>'+a:"RateRadioVideo"==i.type&&(a='<div class="Video">'+("YouTube"===t.extra[0]?'<iframe width="320" height="180" src="http://www.youtube.com/embed/'+t.extra[1]+'?rel=0" frameborder="0" allowfullscreen></iframe>':'<iframe src="http://player.vimeo.com/video/'+t.extra[1]+'" width="320" height="180" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>')+"</div>"+a);var l=o('<li class="Option Content">  <div class="OptionContent Rounded8px">    <div class="CellLabel">'+a+'</div>    <div class="CellCheckGroup"><table><tr></tr></table></div>  </div></li>').appendTo(this.optionsContainer.children("ul")).data({label:t.label,value:t.value,extra:t.extra});return i.setLevels(i.options.levels,l),l},this.setLevels=function(e,t){void 0===t&&(t=i.optionsContainer.children("ul").children("li:not(.Header)")),o(t).each((function(){for(var t=o(this).find(".CellCheckGroup tr").empty(),n=0;n<e;++n)o('<td class="Rounded5px "><div class="CellCheck"><span class="CheckMark ORFontIcon"></span></div></td>').appendTo(t).on({click:i.optionClickEvent})})),e!=i.options.levels&&(i.options.levels=e,i.setHeaderStyle(i.options.headerStyle))},this.setHeaderStyle=function(e){var t=this.optionsContainer.children("ul").children("li").first(),n=e!=i.options.headerStyle,a=t.find(".CellHeadings tr");(n||0==a.length)&&(a=o("<table><tr></tr></table>").appendTo(t.find(".CellHeadings").empty()).find("tr"),n=!0);var l=a.children().length;switch(i.useHeaderAsLabels=i.options.levels===l,e){case"EachCell":case"OneToN":var s=l-i.options.levels;if(0!=l||3!=i.options.levels){if(s>0)for(var d=0;d<s;++d)a.children(":last").remove();else if(s<0)for(d=0;d<-s;++d)a.append("<td>"+("EachCell"!=e?d+l+1:".")+"</td>");break}case"TwoLabels":case"ThreeLabels":n&&(o('<td class="HeadingLeft">'+m+"</td>").appendTo(a),"ThreeLabels"!=e&&"EachCell"!=e||o('<td class="HeadingCenter">'+v+"</td>").appendTo(a),o('<td class="HeadingRight">'+f+"</td>").appendTo(a))}i.options.headerStyle=e},this.setHeaderLabels=function(e){this.optionsContainer.children("ul").children("li").first().find(".CellHeadings").html(e)},this.setHeaderCategory=function(e){this.optionsContainer.children("ul").children("li").first().find(".CellLabel").html(e)},this.getRateData=function(){return t.console("Getting Rate data"),{levels:i.options.levels,headerStyle:i.options.headerStyle,headerLabels:this.optionsContainer.children("ul").children("li").first().find(".CellHeadings").html(),headerCategory:this.optionsContainer.children("ul").children("li").first().find(".CellLabel").html()}},this.optionClickEvent=function(e){o(this).closest("table").find(".CellCheck").removeClass("Selected"),o(this).find(".CellCheck").addClass("Selected");var t=o(this).closest(".Option.Content").data("label"),n=o(this).parent().find(".CellCheck").map((function(){return o(this).hasClass("Selected")})).get().indexOf(!0)+1;i.useHeaderAsLabels&&(n=i.optionsContainer.children("ul").children("li").first().find(".CellHeadings tr > td").eq(n-1).html()),e.stopPropagation(),void 0!==i.events.activate&&i.events.activate(i.currentContainer),i.events.valueSet({value:{label:t,index:n},caller:i.currentContainer,relatedItemId:i.getItemId(),remainInItem:!i.hasValue()})},this.hasValue=function(){return i.optionsContainer.children("ul").children("li").slice(1).find(".CellCheckGroup").filter((function(){return o(this).find(".Selected").length>0})).length==i.optionsContainer.children("ul").children("li").length-1},this.getValue=function(){t.console("Getting rank value");var e={};return i.optionsContainer.children("ul").children("li").slice(1).each((function(t){e[o(this).data("label")]=o(this).find(".CellCheck").map((function(){return o(this).hasClass("Selected")})).get().indexOf(!0)})),e},this.reset=function(){i.optionsContainer.children("ul").children("li").slice(1).each((function(){o(this).find(".CellCheck").removeClass("Selected")}))},this.setValue=function(e){i.value=e};var l=o.extend({type:"Notification",selectedOption:0,onSelect:void 0},e),s=this.item.children(".ORInput"),d=o('<div class="uiRadioChoice uiMultiOption uiGeneric ui'+this.type+' uiCellCheckGroup"></div>').appendTo(s);this.currentContainer=d,this.optionsContainer=o('<div class="Options"><ul></ul></div>').appendTo(d),o('<li class="Option Header">  <div class="OptionContent Rounded8px">    <div class="CellLabel"></div>    <div class="CellHeadings"></div>    <div class="CellClose"></div>  </div></li>').appendTo(this.optionsContainer.children("ul")),l.randomize&&t.randomizeArray(l.options),o.each(l.options,(function(e,t){i.createOption({label:t.label,value:t.value,extra:t.extra})})),this.optionsContainer.on({mouseenter:function(){o(this).find("li").each((function(){var e=o(this).find(".OptionContent").innerHeight();o(this).find("table").css({height:e})}))}}),this.setHeaderLabels(this.options.headerLabels),this.setHeaderCategory(this.options.headerCategory),this.setHeaderStyle(this.options.headerStyle)},this.selector=function(e){o.extend(this,new a.base(e));var t=this.item,i=this,n=o.extend({id:"NotAvailable",description:"Description of the command",enabled:!0,horizontal:!0},e);this.options=n.options,this.selectedValue,this.setSelectedItem=function(e,a){for(var l=o.extend({skipEvents:!1},a),s=0;s<this.options.length;++s)if(e==this.options[s].value){t.find(".SelectedItem").text(this.options[s].label),i.selectedValue=this.options[s].value;break}l.skipEvents||void 0===n.command||n.command(e)},this.loadData=function(){var e=t.find(".DropDownOptions ul");e.empty();for(var n=0;n<i.options.length;++n){var a,l=!1;"object"!=typeof i.options[n]?i.options[n]={html:i.options[n],label:i.options[n],value:i.options[n]}:"SEPARATOR"==i.options[n].value?(i.options[n]={html:'<div class="Separator Rounded5px">'+i.options[n].label+"</div>",label:"Separator",value:0},l=!0):null==i.options[n].value&&(i.options[n].value=i.options[n].label),a=o("<li>"+i.options[n].html+"</li>").data("value",i.options[n].value).data("label",i.options[n].label).appendTo(e),0==l?a.on("click",(function(e){var n=o(this).data("value");i.setSelectedItem(n),t.find(".DropDownContainer").slideToggle("fast"),e.stopPropagation()})):a.addClass("Special")}},this.getValue=function(){return i.selectedValue},this.setValue=function(e,t){i.setSelectedItem(e,t)},this.getLabel=function(){return t.find(".SelectedItem").first().text()},t.addClass("SelectorItem").children(".ORInput").append('<div class="Selector"><table><tr><td><div class="SelectedItem"></div></td><td class="DropDownArrowCell"><div class="DropDownArrow Icon"></div></td></tr></table></div><div class="DropDownContainer InputShadow"><div class="DropDownOptions Scrollable"><ul></ul></div></div>'),t.find(".DropDownContainer"),this.loadData(),this.options.length>0&&(null!=n.value?this.setSelectedItem(n.value,{skipEvents:!0}):this.setSelectedItem(this.options[0].value,{skipEvents:!0})),t.find(".DropDownContainer").on({click:function(e){e.stopPropagation()},dblclick:function(e){e.stopPropagation()}}),t.find(".ORInput").on("click",(function(e){o(".DropDownContainer").not(t.find(".DropDownContainer")).slideUp("fast"),t.find(".DropDownContainer").slideToggle("fast"),e.stopPropagation()})),void 0!==n.value&&this.setValue(n.value,{skipEvents:!0})},this.checkbox=function(e){o.extend(this,new a.base(e));var i=o.extend({id:"Unset",description:"Description of the command",command:void 0,value:!1},e),n=this,l=this.item;this.toggleSelection=function(e,o){t.console("Selecting box "+i.id),n.setValue(!l.find(".BoxMark").hasClass("Selected"))},this.reset=function(){return l.find(".BoxMark").removeClass("Selected")},this.getValue=function(){return l.find(".BoxMark").hasClass("Selected")},this.setValue=function(e,t){var a=o.extend({skipEvents:!1},t),s=l.find(".BoxMark");e?s.addClass("Selected"):s.removeClass("Selected"),a.skipEvents||void 0===i.command||i.command(n.getValue())},l.addClass("BooleanItem").find(".ORInput").remove(),l.prepend('<div class="BoxMark"><div class="CheckMark ORFontIcon"></div></div>'),l.children().wrapAll('<div class="Checkbox" />'),l.append('<div style="clear: both;" />'),void 0!==i.positionY&&l.css({position:"absolute",left:i.positionX,top:i.positionY}),l.on({click:this.toggleSelection})},this.label=function(e){o.extend(this,new a.base(e)),o.extend({id:"NotAvailable"},e),this.item.addClass("LabelItem").children(".ORInput").remove()},this.input=function(e){o.extend(this,new a.base(e)),e=o.extend({id:t.randomId(),size:"",defaultValue:"",placeholder:"",controlClass:"",description:"Description of the command"},e);var i=this,n=this.item;this.defaultValue=e.defaultValue,this.defaultValueEvents={focus:function(){n.children(".ORInput").children(".InputField").attr("value")==i.defaultValue&&i.setValue("")},blur:function(){""==i.getValue()&&i.setValue(i.defaultValue)}},this.getValue=function(){var e=n.children(".ORInput").children(".InputField").val();return e!=i.defaultValue?e:""},this.reset=function(){n.children(".ORInput").children(".InputField").val(i.defaultValue)},this.setValue=function(e,t){var a=o.extend({skipEvents:!1},t),l=n.children(".ORInput").children(".InputField");return l.attr("value",e),e!=this.defaultValue?l.addClass("HasValue"):l.removeClass("HasValue"),a.skipEvents||i.events.valueSet({value:e,caller:this.currentContainer,relatedItemId:this.getItemId()}),n},this.setDefaultValue=function(e){i.defaultValue=e,i.setValue(e),""!=e?n.children(".ORInput").children(".InputField").on(i.defaultValueEvents):n.children(".ORInput").children(".InputField").off(i.defaultValueEvents)};var l=this.item.addClass("InputItem").children(".ORInput");this.currentContainer=o('<input class="InputField '+e.controlClass+'" id="Text'+e.id+'" '+(void 0!==e.placeholder?'placeholder="'+e.placeholder+'" ':"")+' type="text" />').appendTo(l),n.addClass(e.size),""!=this.defaultValue&&this.setDefaultValue(this.defaultValue),n.children(".ORInput").children(".InputField").on({change:function(){i.setValue(o(this).val())}}),void 0!==e.value&&this.setValue(e.value,{skipEvents:!0})},this.textArea=function(e){e=o.extend({controlClass:"",placeholder:"",id:t.randomId()},e);var i=this;o.extend(this,new a.input(e));var n=this.item.removeClass("InputItem").addClass("TextAreaItem").children(".ORInput").empty();this.currentContainer=o('<textarea class="InputField '+e.controlClass+'" id="TextArea'+e.id+'" placeholder="'+e.placeholder+'" />').appendTo(n),this.item.find("textarea").on({change:function(){i.setValue(o(this).val())}}),this.reset=function(){i.item.find("textarea").attr("value",i.defaultValue)},""!=this.defaultValue&&this.setDefaultValue(this.defaultValue)},this.textEditor=function(e){o.extend(this,new a.base(e));var i=o.extend({id:t.randomId(),size:"",defaultValue:"",height:120},e),n=this.item,l=this;this.defaultValue=i.defaultValue,this.defaultValueEvents={focus:function(e){n.editor.instanceById("TextArea"+i.id).getContent()==l.defaultValue&&l.setValue("")},blur:function(){""==l.getValue()&&l.setValue(l.defaultValue)}},this.setDefaultValue=function(e){l.setValue(e),l.defaultValue=e,""!=e?n.find(".ORInput .nicEdit-main").on(l.defaultValueEvents):n.find(".ORInput .nicEdit-main").off(l.defaultValueEvents)},this.getValue=function(){var e=n.editor.instanceById("TextArea"+i.id).getContent();return e!=l.defaultValue&&"<br>"!=e?e:""},this.setValue=function(e){return t.console("textEditor - Setting value to "+e),n.editor.instanceById("TextArea"+i.id).setContent(e)},this.item.addClass("TextEditor").children(".ORInput").append('<textarea id="TextArea'+i.id+'"></textarea>'),n.addClass(i.size),o((function(){t.console("textEditor - Creating");var e="100%";n.editor=new nicEditor({height:i.height,maxHeight:i.height,iconsPath:"/scripts/nicedit/nicEditorIcons.gif"}).panelInstance("TextArea"+i.id),t.console("textEditor - Width is 100%");var o=n.find(".ORInput").first().children();o.eq(0).css("width",e),o.eq(1).css("width",e),o.eq(0).children().first().css("border-color","").css("border-width","").addClass("EditorToolbar"),o.eq(1).css("border-color","").css("border-width","").addClass("EditorArea"),n.find(".ORInput .nicEdit-main").width(e).on({focus:function(){n.find(".ORInput").first().addClass("Selected")},blur:function(){n.find(".ORInput").first().removeClass("Selected")},mousedown:t.stopPropagation,click:t.documentClick}),""!=l.defaultValue&&(t.console("textEditor - Setting balue "+l.defaultValue),l.setDefaultValue(l.defaultValue))}))},this.spinner=function(e){o.extend(this,new a.base(e));var n=o.extend({id:"NotAvailable",displayTime:!1,maxValue:void 0,minValue:void 0,increment:1,fastIncrement:5,value:0,zeroIsUnlimeted:!0,repeatDelay:200,format:"numeric",zeroLabel:i},e),l=this.item,s=this;this.value=n.value,this.currentIntervalIncrement=0,this.currentIntervalDecrement=0,this.incrementHandler=function(e,t){s.changeValue(n.increment)},this.incrementPressedHandler=function(e,t){s.currentIntervalIncrement=setInterval((function(){s.changeValue(n.fastIncrement*n.increment)}),n.repeatDelay)},this.incrementReleasedHandler=function(){clearInterval(s.currentIntervalIncrement)},this.decrementHandler=function(e,t){s.changeValue(-n.increment)},this.decrementPressedHandler=function(e,t){s.currentIntervalDecrement=setInterval((function(){s.changeValue(-n.fastIncrement*n.increment)}),n.repeatDelay)},this.decrementReleasedHandler=function(){clearInterval(s.currentIntervalDecrement)},this.wheelHanlder=function(e,t){return s.changeValue(n.increment*t),!1},this.changeValue=function(e){var t=s.getInputValue()+e;null!=n.minValue&&t<n.minValue&&(t=n.minValue),null!=n.maxValue&&t>n.maxValue&&(t=n.maxValue),s.setValue(t)},this.getInputValue=function(){var e=l.find("input").val();if(e==n.zeroLabel)return 0;if("time"==n.format){var i=e.split(/\:/),o=Number(i[0]),a=Number(i[1]),s=Number(i[2]);return t.console("Time stepper:  "+o+"_"+a+"_"+s),3600*o+60*a+s}return parseInt(e)},this.setValue=function(e,t){var i,a=o.extend({skipEvents:!1},t);if(0==e&&n.zeroIsUnlimeted)i=n.zeroLabel;else if("time"==n.format){var d=parseInt(e/3600),r=parseInt(e/60)%60,c=e%60;i=d+":"+(r<10?"0":"")+r+":"+(c<10?"0":"")+c}else i=e;return l.find("input").val(i),a.skipEvents||(l.find("input").trigger("change"),void 0!==n.command&&n.command(e)),s},this.getValue=function(){return s.getInputValue()},l.addClass("Spinner").find(".ORInput").append('<table><tr><td class="Less"><div class="Icon"></div></td><td class="Field"><div><input type="text" /></div></td><td class="More"><div class="Icon"></div></td></tr></table>'),l.find("input").on({click:function(e){o(this).select()},focus:function(e){l.find(".ORInput .Field div").addClass("Selected")},blur:function(e){l.find(".ORInput .Field div").removeClass("Selected")}}),l.find(".ORInput .Less").on({click:this.decrementHandler,mousedown:this.decrementPressedHandler,mouseup:this.decrementReleasedHandler,mouseleave:this.decrementReleasedHandler}),l.find(".ORInput .More").on({click:this.incrementHandler,mousedown:this.incrementPressedHandler,mouseup:this.incrementReleasedHandler,mouseleave:this.incrementReleasedHandler}),l.find(".ORInput").on("mousewheel",this.wheelHanlder),this.setValue(this.value,{skipEvents:!0})},this.dateTime=function(e){o.extend(this,new a.input(e));var t=o.extend({id:"NotAvailable",displayTime:!1,controlClass:""},e),i=this.item;i.addClass("DateTimeSelector").find(".ORInput").append('<input type="text" class="'+t.controlClass+'" id="Time'+t.id+'" />'),i.find(".ORInput").addClass("DateTime");var n=i.find(".ORInput").children("input").eq(0).addClass("DateField"),l=i.find(".ORInput").children("input").eq(1).addClass("TimeField");o((function(){n.datepicker({showAnim:"slideDown",duration:200}),l.timepicker({showAnim:"slideDown",duration:200,defaultTime:"00:00"})})),this.getValue=function(){if(n.datepicker("getDate")){var e=n.datepicker("getDate");return e.setHours(l.timepicker("getHour")),e.setMinutes(l.timepicker("getMinute")),e.toString()}},this.setValue=function(e){if(e){var t=new Date(e);n.datepicker("setDate",t),l.timepicker("setTime",t.getHours()+":"+t.getMinutes())}}}}const g={NEW_SURVEY_TITLE:"Survey - %s",NEW_SURVEY_TITLE_HINT:"e.g. Favorite editors",MENU_PANEL_SURVEY:"Survey",MENU_PANEL_ITEMS:"Items",MENU_PANEL_CLIPBOARD:"Clipboard",MENU_PANEL_PROPERTIES:"Properties",MENU_PANEL_GET_CODE:"Publish",DONE:"Done",PUBLISH_TITLE:"Publish Survey",PUBLISH_SHARE_A_LINK:"Direct link share",PUBLISH_SHARE_A_LINK_DESCRIPTION:"People can participate in your survey using this link:",PUBLISH_USE_API:"Integrate into my app",PUBLISH_USE_API_DESCRIPTION:"If you want to embed this survey on your own web or app, see our docs here for our React and plain JS examples",PUBLISH_COPY_LINK_TO_CLIPBOARD:"Copy Link",PUBLISH_TRY_SURVEY:"Try out here",DISPLAY_RULES_TITLE:"Visibility Rules",DISPLAY_RULES_SELECT:"Build a new Rule",DISPLAY_RULES_DESCRIPTION:"Here you can show or hide items based on condition you specify",DISPLAY_RULES_MAIN_ACTION:"the selected item when:",DISPLAY_RULES_MAIN_ACTION_SHOW:"Show",DISPLAY_RULES_MAIN_ACTION_SHOW_DESCRIPTION:"Only <b>Show</b> the selected items when...",DISPLAY_RULES_MAIN_ACTION_HIDE:"Hide",DISPLAY_RULES_MAIN_ACTION_HIDE_DESCRIPTION:"Only <b>Hide</b> the selected items when...",DISPLAY_RULES_ADD_RULE:"Save Rule",PROPERTIES_DISPLAY_RULES_EDIT:"Edit rules (%s)",DISPLAY_RULES_CLEAR_RULE:"Clear Rule",DISPLAY_RULES_NONE_TITLE:"This item does not have rules yet.",DISPLAY_RULES_NONE_MSG:"To add rules, just select the items, as if you were the respondant.",DISPLAY_RULES_ADDED:"The rule has been saved",DISPLAY_RULES_EMPTY:"The rule is empty. Please make sure to select something before saving.",DISPLAY_RULES_ITEM:'Item "%s" has value "%s"',DISPLAY_RULES_ITEM_INVERT:'Item "%s" does not have value "%s"',DISPLAY_RULES_UNASSIGNED:"Unassigned",DISPLAY_RULES_OR:"OR",DISPLAY_RULES_AND:"AND",INSERT_NEW_ITEM:"Drag <b>item</b> here to insert",INSERT_NEW_ITEM_PASTE:"Click to paste here",PROPERTIES_FOR:"Properties for ",ITEM_:"Item",SETTINGS_INTRO_TEXT:"Introduction (optional)",SETTINGS_INTRO_DESCRIPTION:"Intro allows showing users a message before they rendering the first question. It can used to ask users for participation.",SETTINGS_CLOSING_TEXT:"Closing",SETTINGS_CLOSING_DESCRIPTION:"Message to show when completing survey. If not set, a default thank you message will be displayed.",SETTINGS_ENABLE_SURVEY_PREVIEW:"Respondant may preview survey",SETTINGS_SCROLLING_MODE:"Scrolling Mode",SETTINGS_START_DATE:"Start delivery on",SETTINGS_END_DATE:"End delivery on",SETTINGS_LABEL_PUBLICATION:"Publication",SETTINGS_SURVEY_STATUS:"Survey Status",SETTINGS_LABEL_SERVING:"Survey Serving",SETTINGS_LABEL_TIME_LIMIT:"Limit survey time <small>(hours : minutes : seconds)</small>",SETTINGS_GLOBAL_TIME_LIMIT:"Global",SETTINGS_GLOBAL_HOURS:"Hours",SETTINGS_GLOBAL_MINUTES:"Minutes",SETTINGS_GLOBAL_SECONDS:"Seconds",SETTINGS_PER_ITEM_TIME_LIMIT:"Per item",SETTINGS_LABEL_RANDOMIZE:"Randomize",SETTINGS_ENABLE_ITEM_RANDOMIZE:"Deliver items randomly where possible",SETTINGS_ENABLE_OPTION_RANDOMIZE:"Sort randomly options for selection items",SETTINGS_ENABLE_HIDDEN_ITEMS_VISIBLE:'Disable instead of hidding "not visible" items',SETTINGS_VISIBLE_ITEMS:"Visible items",SETTINGS_DONT_HIDE_NOT_VISIBLE_ITEMS:"Disable items instead of hiding according visibility rules",SETTINGS_LABEL_NAVIGATION:"Navigation",SETTINGS_LABEL_APPEARANCE:"Appearance",SETTINGS_TEMPLATE:"Template",SETTINGS_THEME:"Theme",SETTINGS_LABEL_OBJECTIVES:"Objectives",SETTINGS_MAX_RESPONSES_PER_DAY:"Collect daily",SETTINGS_MAX_RESPONSES_TOTAL:"Limit survey to",SETTINGS_RESPONSES:"Responses",SETTINGS_DELIVERY_STRATEGY:"Delivery strategy",SETTINGS_LABEL_USER_CONTROL:"User Control",SETTINGS_ENABLE_PAUSE:"Allow survey to be paused",SETTINGS_LABEL_ACCEPT_AT_MOST:"Accept",SETTINGS_LABEL_PER_USER:"responses per user",SETTINGS_EMBEDDING_ONLY_MY_DOMAINS:"Only allow embedding on my domains",SETTINGS_LABEL_EMBEDDING_CONTROL:"Embedding Control",SETTINGS_EMBEDDING_ADDITIONAL_DOMAINS:"Also allow embedding on these domains:",SETTINGS_EMBEDDING_ADDITIONAL_DOMAINS_NOTE:"Enter one domain per line (ex: *.example.com)",SETTINGS_LABEL_USER_VALIDATION:"User Validation",SETTINGS_LABEL_ENABLE_CAPTCHA:"Enable captcha validation",SETTINGS_REQUIRE_ACCESS_CODE:"Require access code",SETTINGS_VERIFY_THROUGH_EMAIL:"Verify through email",SETTINGS_VERIFY_THROUGH_EMAIL_DOMAINS:"Limit email domains to:",LABEL:"Label",PROPERTIES_LAYOUT:"Layout",PROPERTIES_MULTISELECT:"Multiple Selection",PROPERTIES_SHOW_ICON:"Show Icons",PROPERTIES_REQUIRED:"Required Item",PROPERTIES_DISPLAY_RULES:"Visibility",PROPERTIES_DISPLAY_RULES_ADD:"Add new rule",PROPERTIES_VALIDATOR:"Validator",PROPERTIES_NUMBER_OF_GROUPS:"Groups",PROPERTIES_HAS_OTHER:"Show 'Other'",LABEL_DEFAULT:"Enter label text here",CLOSE_WINDOW:"Close",HIDE_MESSAGE:"Hide",PRO:"Pro",PRO_ITEM_DETAIL:"This item type is available for <b>standard</b> accounts.",DropDown_NAME:"Dropdown",RadioText_NAME:"Radio Choice (Text)",RadioImage_NAME:"Radio Choice (Image)",RadioVideo_NAME:"Radio Choice (Video)",RadioHTML_NAME:"Radio Choice (HTML)",ListText_NAME:"List Check (Text)",ListImage_NAME:"List Check (Image)",ListVideo_NAME:"List Check (Video)",ListHTML_NAME:"List Check (HTML)",BinaryYesNo_NAME:"Binary (Yes/No)",BinaryGender_NAME:"Binary (Gender)",BinaryTrueFalse_NAME:"Binary (True/False)",ListCheck_NAME:"Checkbox",RateRadioText_NAME:"Rate (Text)",RateRadioImage_NAME:"Rate (Image)",RateRadioVideo_NAME:"Rate (Video)",RateRadioHTML_NAME:"Rate (HTML)",OpenSingleLine_NAME:"Open (Single Line)",OpenMultipleLine_NAME:"Open (Multiple Line)",OpenRichText_NAME:"Open (Rich Text)",Label_NAME:"Label",Matrix_NAME:"Matrix",Group_NAME:"Group",OPEN_DEFAULT_TEXT:"Enter default help text (optional)",INSERT_ROW:"Add Row",INSERT_COLUMN:"Add Column",WIDTH:"Width",WIDTH_AUTO:"Auto",DEFAULT:"Default",SAVE_SUCCESS:"Survey saved",SAVE_ERROR:"Could not save survey",NO_SESSION:"Your session has expired",SURVEY_CANT_LOAD:"Can't load this survey",SURVEY_CANT_SAVE:"Can't save the survey in this moment (have network?)",SURVEY_CANT_AUTOSAVE:"Can't turn on autosave"};var E,T=[{label:"Deliver",html:"<b>Deliver.</b> Survey will be delivered according to publishing rules."},{label:"Suspend",html:"<b>Suspend.</b> Pause delivery."},{label:"Archive",html:"<b>Archived.</b> Survey is no longer active."}],C=[{label:"Inmediate",html:"<b>Inmediate.</b> Deliver surveys as visitors arrive."}],y=[{label:"Smart",html:"<b>Smart (Recommended).</b> Survey will scroll automatically when possible."},{label:"Block",html:"<b>Block.</b> Scrolling is still done per item, but always invoked by user."},{label:"Classic",html:"<b>Classic.</b> Ordinary mouse scrolling. Buttons advance a fixed amount."}],R=[{label:"%",html:"Percent (%)",value:"Percent"},{label:"px",html:"Pixels (px)",value:"Pixels"},{label:"em",html:"Em units (em)",value:"Em"}],L=[{value:"Right",label:"Left",html:"Label at Left"},{value:"Left",label:"Right",html:"Label at Right"},{value:"Bottom",label:"Top",html:"Label at Top"},{value:"Top",label:"Bottom",html:"Label at Bottom"},{label:"No Label",value:"NoLabel",html:"Widget with no label"}],x=[{label:"Vertical",html:"List stacked vertically"},{label:"Horizontal",html:"List stacked horizontally"}],w=[{label:"Small",html:"Small input"},{label:"Medium",html:"Medium input"},{label:"Large",html:"Large input"},{label:"Maximum",html:"Maximum input"}],O=[{label:"Visible",html:"Visible"}],_=[{label:"S / S ",value:"Small HSmall",html:"Wide Small, Height Small"},{label:"S / M",value:"Small HMedium",html:"Wide Small, Height Medium"},{label:"S / L",value:"Small HLarge",html:"Wide Small, Height Large"},{label:"M / S",value:"Medium HSmall",html:"Wide Medium, Height Small"},{label:"M / M",value:"Medium HMedium",html:"Wide Medium, Height Medium"},{label:"M / L",value:"Medium HLarge",html:"Wide Medium, Height Large"},{label:"L / S",value:"Large HSmall",html:"Wide Large, Height Small"},{label:"L / M",value:"Large HMedium",html:"Wide Large, Height Medium"},{label:"L / L",value:"Large HLarge",html:"Wide Large, Height Large"},{label:"Max / S",value:"Maximum HSmall",html:"Wide Maximum, Height Small"},{label:"Max / M",value:"Maximum HMedium",html:"Wide Maximum, Height Medium"},{label:"Max / L",value:"Maximum HLarge",html:"Wide Maximum, Height Large"}],D=[{label:"Two Labels",value:"TwoLabels",html:"Two Labels"},{label:"Three Labels",value:"ThreeLabels",html:"Three Labels"},{label:"Each Cell",value:"EachCell",html:"Each Cell"},{label:"Attribute Header",value:"OnlyAttributeHeader",html:"Only Attribute Header"},{label:"No Headings",value:"NoHeadings",html:"No Headings"},{label:"Common Headings",value:"SEPARATOR"},{label:"1...n",value:"OneToN",html:"1, 2, 3 ... n"}];E=$.map(["Gray","Black","Red"],(function(e,t){return{label:e,value:e,html:'<div class="Theme '+e+'"></div><div class="ThemeLabel">'+I["THEME_"+e]+"</div>"}}));var P,A,N,M,k=$.map(["Simple","Slim","ButtonLess"],(function(e,t){return{label:e,value:e,html:'<div class="Template '+e+'"></div>'}}));function V(e,t){var i=e;i.extend(this,new S(i,t));var a=this;i(window).off("click.ORBaseUI");var l,s,d=!1;i((function(){d=!0})),i(window).on({click:function(){i(".DropDownContainer").slideUp("fast")},mousemove:function(e){e.pageX,e.pageY},scroll:function(e){i(".ToolTip").stop(!0,!0).fadeOut("fast")}});var r=[],c=[];this.toolbarGroup=function(e){var t=i.extend({id:"unset",color:"#990000",title:"Toolbar",width:"20%",visible:!0},e),n=t.id;i('<div class="Container"><div class="Group" id="'+n+'"></div></div>').appendTo("#SurveyEditorToolbar"),i("#"+n).parent().width(t.width),i('<div class="Title"><span>'+t.title+"</span></div>").appendTo("#"+n),i('<div class="Fields"></div>').appendTo("#"+n),t.visible||i("#"+n).hide()},this.toolbar=function(e){i.extend({color:"#990000",scrollable:!0},e),i("#SurveyEditorToolbar").size()>0&&(i("#SurveyEditorToolbar").css("width",i("#SurveyEditorToolbar").width()),i(window).scroll((function(){var e=i("#SurveyEditorToolbar");if(e.size()>0){var t=e.parent().position().top;i(window).scrollTop()>t&&"fixed"!=e.css("position")?e.addClass("Floated"):i(window).scrollTop()<=e.parent().position().top&&e.removeClass("Floated")}})))},this.inlineEdit=function(e){i.extend(this,new a.label(e));var n="Inline"+t.randomId();this.item.children(".Label").attr("id",n),a.floatedEditor({id:n,htmlMode:!1}),this.item.children(".Label").on({click:function(e){i(this).html()==g.LABEL_DEFAULT&&i(this).selText(),i("#InlineEditPanel").show().position({my:"left bottom",at:"left top",offset:"-15px -5px",of:i(this)})},blur:function(){i("#InlineEditPanel").hide()},mousedown:t.stopPropagation,mousemove:t.stopPropagation,mouseup:t.stopPropagation})},this.floatedEditor=function(e){var n=(e=i.extend({id:"Unset",htmlMode:!1,events:{change:function(){},beforeChange:function(){}}},e)).id,o={buttonList:["bold","italic","underline","left","center","right","justify","fontSize","fontFamily","fontFormat","forecolor","bgcolor"]},h={fullPanel:!0};this.loadInlinePanel=function(){if(t.console("loadInlinePanel "+i("#InlineEditPanel").size()),0==i("#InlineEditPanel").size()){l=new nicEditor(o),s=new nicEditor(h),i('<div id="InlineEditPanel" style="width: 470px;"></div>').appendTo("body"),i('<div id="InlineEditPanelFull" style="width: 470px;"></div>').appendTo("body"),l.setPanel("InlineEditPanel"),s.setPanel("InlineEditPanelFull"),l.addEvent("focus",(function(){a.floatedEditor.inlineEditorContent=l.selectedInstance.getContent(),t.console("EDITOR - events.beforeChange() - "+e.events.beforeChange),e.events.beforeChange()})),l.addEvent("blur",(function(){a.floatedEditor.onChange(e.events.change)})),i("#InlineEditPanel, #InlineEditPanelFull").children().css({"-moz-border-radius":"5px","-webkit-border-radius":"5px","border-radius":"5px","-moz-box-shadow":"0px 0px 2px 2px #999","-webkit-box-shadow":"0px 0px 2px 2px #999","box-shadow":"0px 0px 2px 2px #999"});var n={mousedown:t.stopPropagation,mousemove:t.stopPropagation,mouseup:t.stopPropagation};i.each(r,(function(){l.addInstance(this),i("#"+this).on(n)})),i.each(c,(function(){s.addInstance(this),i("#"+this).on(n)})),i(document).on({click:function(){0==i(".nicEdit-selected").size()&&a.floatedEditor.hide()}})}},runOrWhenDOMReady(this.loadInlinePanel),d?(e.htmlMode?s.addInstance(n):l.addInstance(n),i("#"+n).on({mousedown:t.stopPropagation,mousemove:t.stopPropagation,mouseup:t.stopPropagation})):e.htmlMode?c.push(n):r.push(n)},this.floatedEditor.hide=function(e,n){i("#InlineEditPanel, #InlineEditPanelFull").hide(),void 0===e||!0===e?i(".LabelItem .Label, .CellLabel .Legend").blur():(t.console("Manual inline hide event"),a.floatedEditor.onChange(n))},this.floatedEditor.onChange=function(e){var i=a.floatedEditor.inlineEditorContent;void 0!==i&&void 0!==l.selectedInstance&&null!=l.selectedInstance&&i!==l.selectedInstance.getContent()&&(t.console("EDITOR - events.change() - "+e),a.floatedEditor.inlineEditorContent=l.selectedInstance.getContent(),e())},this.choiceEditable=function(e){e=i.extend({events:{}},e);var l=this,s=function(){t.console("Hiding floated editor"),a.floatedEditor.hide(!1,e.events.sortComplete),void 0!==e.events.beforeChange&&(t.console("Triggering before change"),e.events.beforeChange())};this.deleteOption=function(t){void 0!==e.events.update&&e.events.update(),i(this).closest("li").empty().remove(),t.stopPropagation()},this.addOption=function(t){void 0!==e.events.addOption&&e.events.addOption(),l.convertOptionToEditableOption(l.createOption())},this.optionClickEvent=function(e){},this.setOther=function(t){t&&"Radio"==l.parentType?l.convertOptionToEditableOption(l.createOption({label:e.other.label,other:e.other})):l.optionsContainer.children("ul").children("li.Option.Other").remove()},this.convertOptionToEditableOption=function(o){i(o).unbind("click").on("click",this.optionClickEvent).find(".Legend").empty().prepend(i(o).data("label")),"RadioImage"==e.type||"ListImage"==e.type||"RateRadioImage"==e.type?(i(o).children(".OptionContent").children(".CellLabel").addClass("Rounded3px").addClass("RadioImageElement").addClass("RadioMediaElement").empty().append('<div class="Image"></div><div class="Legend">'+(i(o).data("label")||n)+"</div>"),new a.imageUploader({container:i(o).children(".OptionContent").children(".CellLabel").children(".Image"),image:i(o).data("extra")})):"RadioVideo"!=e.type&&"ListVideo"!=e.type&&"RateRadioVideo"!=e.type||(i(o).children(".OptionContent").children(".CellLabel").addClass("Rounded3px").addClass("RadioVideoElement").addClass("RadioMediaElement").empty().append('<div class="Video"></div><div class="Legend">'+(i(o).data("label")||n)+"</div>"),new a.videoUploader({container:i(o).children(".OptionContent").children(".CellLabel").children(".Video"),video:i(o).data("extra")})),i('<div class="CellClose"><div class="Close"></div></div>').appendTo(i(o).children(".OptionContent")).on({click:l.deleteOption}),i(o).on({mousedown:s}),i(o).find(".Legend, .OtherInput .Label").each((function(){var o=t.randomId();i(this).attr("id",o),a.floatedEditor({id:o,htmlMode:"RadioHTML"==e.type||"ListHTML"==e.type||"RateRadioHTML"==e.type}),i(this).on({keypress:function(e){13==e.keyCode&&(l.addOption(),l.optionsContainer.children("ul").children("li").find(".Legend, .OtherInput .Label").click(),e.preventDefault())},click:function(){var t,o;"RadioHTML"!=e.type&&"ListHTML"!=e.type&&"RateRadioHTML"!=e.type?(t="#InlineEditPanelFull",o="#InlineEditPanel"):(t="#InlineEditPanel",o="#InlineEditPanelFull"),i(t).hide(),i(o).show().position({my:"left bottom",at:"left top",offset:"-15px -8px",of:i(this).closest("ul")}),i(this).html()==n&&i(this).selText()}})}))},this.makeEditable=function(){this.optionsContainer.children("ul").children("li").not(".Header").each((function(){l.convertOptionToEditableOption(this)})),this.optionsContainer.children("ul").children("li.Header").children(".OptionContent").each((function(){var e=t.randomId();i(this).attr("id",e),a.floatedEditor({id:e,htmlMode:!1}),i(this).on({click:function(){i("#InlineEditPanelFull").hide(),i("#InlineEditPanel").show().position({my:"left bottom",at:"left top",offset:"-15px -8px",of:i(this).closest("ul")})}})})),this.optionsContainer.children("ul").sortable({distance:5,items:"li:not(.Other)",update:e.events.sortComplete}),this.optionsContainer.children("ul").children("li:not(.Other)").on({mousedown:s});var n=i('<div class="OptionCommands"><a class="SortAsc"><div>&nbsp;</div></a> <a class="SortDesc"><div>&nbsp;</div></a> &nbsp;&nbsp;&nbsp;&nbsp;<a class="Add"><div>'+o+"</div></a> </div>").appendTo(this.optionsContainer),d=function(t){e.events.update();var n=l.currentContainer.find(".Option:not(.Header, .Other)").sort((function(e,n){return!0===t.data.ascending?i(n).text()<i(e).text()?1:-1:i(n).text()>i(e).text()?1:-1})),o=l.currentContainer.find(".Option.Other");o.size()?n.insertBefore(o):n.appendTo(l.currentContainer.find("ul"))};n.find(".SortAsc").on("click",{ascending:!0},d),n.find(".SortDesc").on("click",{ascending:!1},d),n.find(".Add").on("click",this.addOption)}},this.listChoiceEditable=function(e){i.extend(this,new a.listChoice(e)),this.addEditableOptions=a.choiceEditable,this.addEditableOptions(e),this.makeEditable()},this.dropDownEditable=function(e){i.extend(this,new a.dropDown(e)),this.addEditableOptions=a.choiceEditable,this.addEditableOptions(e),this.makeEditable()},this.openEndedEditable=function(e){var t,n;switch((e=i.extend({type:"OpenSingleLine"},e)).type){case"OpenRichText":case"OpenMultipleLine":default:n={container:e.container,size:e.open.size,defaultValue:e.defaultText},t="OpenMultipleLine"==e.type?new a.textArea(n):"OpenRichText"==e.type?new a.textEditor(n):new a.input(n)}i.extend(this,t),""!=e.open.defaultText&&this.setValue(e.open.defaultText)},this.rankEditable=function(e){e=i.extend({htmlMode:!1,options:[],levels:5},e),i.extend(this,new a.rank({options:e.options,container:e.container,type:e.type,levels:e.levels,headerStyle:e.headerStyle,headerLabels:e.headerLabels,headerCategory:e.headerCategory})),this.addEditableOptions=a.choiceEditable,this.addEditableOptions(e),this.makeEditable()},this.videoUploader=function(e){var n=this;e=i.extend({container:i("body"),video:""},e),this.processVideoURL=function(){var e,i,o=n.inputField.getValue();o.match(/youtube.com/i)?(e=o.match(/v=([^\&]+)/i),i="YouTube"):o.match(/vimeo.com/i)&&(e=o.match(/vimeo.com\/([^\&\?\/]+)/i),i="Vimeo"),e&&(e=e[1],t.console("Video source "+i+" / id "+e),n.previewVideo(i,e))},this.previewVideo=function(e,t){var i;i="YouTube"===e?'<iframe width="320" height="180" src="http://www.youtube.com/embed/'+t+'?rel=0" frameborder="0" allowfullscreen></iframe>':'<iframe src="http://player.vimeo.com/video/'+t+'" width="320" height="180" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>',n.inputForm.filter(".VideoPreview").empty().show().append(i).parent().data({host:e,id:t})},this.inputForm=i('<div class="VideoInput"></div><div class="VideoPreview"></div>').appendTo(e.container),this.inputField=new a.input({container:this.inputForm.filter(".VideoInput"),label:I.VIDEO_URL+":"}),this.inputField.setValue("http://"),""!==e.video&&(this.previewVideo(e.video[0],e.video[1]),"YouTube"==e.video[0]?this.inputField.setValue("http://www.youtube.com/?v="+e.video[1]):this.inputField.setValue("http://www.vimeo.com/"+e.video[1])),i(this.inputField.field).on({keyup:function(){n.processVideoURL()}})},this.imageUploader=function(e){var n=this;e=i.extend({container:i("body"),image:"",uploadURI:"http://api.imgur.com/2/upload.json",hoster:"imgur"},e),this.upload=function(){var o=this.fileInput.files[0];if(o&&o.type.match(/image.*/)){i(this.fileInput).css({display:"none"}),n.setProgress(0);var a=new FormData;a.append("image",o),"S3"==e.hoster&&t.console("S3 upload no longer supported. Using imgur."),a.append("key","b77379394c5ae907613023b8dd5b77bf");var l=new XMLHttpRequest;l.open("POST",e.uploadURI),l.onload=function(){try{var e=JSON.parse(l.responseText)}catch(e){return n.onError()}n.onUploaded(e.upload)}.closure(this),l.onerror=n.onError.closure(this),l.upload.onprogress=function(e){n.setProgress(e.loaded/e.total)}.closure(this),l.send(a)}else this.onError("Only image files can be uploaded")},this.setProgress=function(e){n.progressBarContainer.show().progressbar({value:parseInt(100*e)}),t.console("Upload progress: "+e)},this.onError=function(){t.console("Error upload image")},this.onUploaded=function(i){if("imgur"==e.hoster){i.links.original;var o=i.links.small_square;i.links.large_thumbnail,n.inputForm.filter(".UploadedImage").append('<img src="'+o+'" />').parent().data("imgSrc",o)}n.inputForm.filter(".UploadedImage").show(),n.progressBarContainer.hide(),t.console("image uploaded")},this.deleteImage=function(){i(n.fileInput).show(),n.inputForm.filter(".UploadedImage").hide(),n.inputForm.filter(".UploadedImage").children("img").remove(),n.progressBarContainer.parent().data("imgSrc","")};var o='<div class="UploadInput">\t<form enctype="multipart/form-data" method="post">\t\t<input type="file" />\t</form></div><div class="UploadedImage">\t<div class="CommandBar"><button class="Delete">'+I.IMAGE_REMOVE+'</button></div></div><div class="ProgressBar"></div>';this.inputForm=i(o).appendTo(e.container),this.fileInput=this.inputForm.filter(".UploadInput").children("form").children("input").get(0),this.progressBarContainer=this.inputForm.filter(".ProgressBar"),""!==e.image&&(this.inputForm.filter(".UploadedImage").append('<img src="'+e.image+'" />'),i(this.fileInput).hide(),this.progressBarContainer.parent().data("imgSrc",e.image),this.inputForm.filter(".UploadedImage").show()),this.inputForm.filter(".UploadedImage").children(".CommandBar").children(".Delete").on({click:n.deleteImage}),i(this.fileInput).on({change:function(){n.upload()}})},this.treeSelector=function(e){var t=i.extend({id:"NotAvailable",toolbarId:"NotAvailable",title:"",description:"Description of the command",items:[],enabled:!0,positionX:"5px",positionY:"10px",width:40,height:0,texturePositionX:"0px",texturePositionY:"0px",events:{clickNode:function(e){alert(e.itemType)}}},e);this.createTreeNode=function(e,t){var c=i.extend({type:"NotAvailable",settings:{id:"NotAvailable",title:"NotAvaible"},events:{clickNode:function(){}},items:[]},e),u=i.extend({id:"NotAvailable",title:""},c.settings);""==u.title&&(u.title=c.type);var p="ItemRow"+u.id;i('<div class="ItemRow Level'+t+'" id="'+p+'"></div>').appendTo("#"+h),i("#"+p).css("top",t*i("#"+p).height()),d[p]=0,r[p]=c.items.length;for(var m=0;m<c.items.length;++m){var v=i.extend({id:"NotAvailable",title:"",description:"Description of the command",enabled:!0,texturePositionX:"0px",texturePositionY:"0px"},c.items[m].settings);""==v.title&&(v.title=c.items[m].type);var f='<div id="'+v.id+'Container"><div class="Item Iconset" style="background-position: '+v.texturePositionX+" "+v.texturePositionY+'" id="'+v.id+'"><div class="Label">'+v.title+'</div><div class="InsertNewItem">'+v.id+"</div>"+(!0!==v.enabled?'<div class="Pro">'+g.PRO+"</div>":"")+"</div></div>";i(f).appendTo("#"+p);var b={children:c.items[m].items.length,itemId:v.id,itemTitle:v.title,row:p,parentItemTitle:u.title};i("#"+v.id).on("click",b,(function(e){if(e.data.children>0){var a=-o;i("#"+e.data.row).children().each((function(o,d){var r=i("#"+d.id).children(":first").attr("id"),c="ItemRow"+r;if(r==e.data.itemId){s=c,i(".Level"+(t+1)).hide(),i("#"+c).show();var u="PathNode"+r;i("#"+n).children().filter(":last").remove(),i('<div class="PathNode"><a href="javascript:void(0);" id="'+u+'">'+e.data.parentItemTitle+"</a></div>").appendTo("#"+n),i('<div class="PathSeparator">/</div><div class="PathNode">'+e.data.itemTitle+"</div>").appendTo("#"+n),i("#"+u).on("click",(function(e){for(var o=l/a,d=t;d<o;++d)i("#"+n).children().filter(":last").remove(),i("#"+n).children().filter(":last").remove();i("#"+n).children().filter(":last").html(i("#"+n).children().filter(":last").text()),l=a*t,i("#"+h).animate({top:l/10+"em"}),s=p}))}else i("#"+c).hide()})),0!=a&&(l+=a,i("#"+h).animate({top:l/10+"em"}))}else c.events.clickNode({itemType:e.data.itemId})})).on("mouseover",b,(function(e){e.data.children})),v.enabled&&i("#"+v.id).draggable({appendTo:"body",containment:i("body"),cursorAt:{top:40,left:50},distance:10,cursor:"move",revert:"invalid",revertDuration:300,zIndex:41,helper:function(e){return'<div class="SurveyDraggingItem">'+i("#"+this.id).parent().html()+'<div class="Legend">'+tr(I.DRAGGING_NEW,this.id)+"</div></div>"}}),new a.tooltip({container:i("#"+v.id),text:v.enabled?b.children>0?I.TIP_CLICK_TO_VIEW_SUBITEMS:I.TIP_CLICK_TO_INSERT:g.PRO_ITEM_DETAIL,position:"top",delay:500}),this.createTreeNode(i.extend({events:c.events},c.items[m]),t+1)}};var n=t.id+"Path",o=54,l=0,s="ItemRowRoot",d=new Array,r=new Array,c="",h="itemContainer"+t.id,u="leftArrow"+t.id,p="rightArrow"+t.id;c+='<div class="GenericItem">',c+='<div class="Path" id="'+n+'"><div class="PathNode">All Items</div></div>',c+='<div class="TreeView" id="'+t.id+'">',i(c+="</div></div>").appendTo("#"+t.toolbarId+" .Fields"),i("#"+t.id).width(t.width),0!=t.height&&i("#"+t.id).height(t.height),i("#"+t.id).parent().css("left",t.positionX).css("top",t.positionY),i('<div class="ItemScroll"><div class="ItemContainer" id="'+h+'"></div>').appendTo("#"+t.id),i('<div class="ItemNavigation"><div class="Arrow Iconset" id="'+p+'"></div><div class="Arrow Iconset" id="'+u+'"></div></div>').appendTo("#"+t.id),i("#"+p).css("background-position","-123px -6px"),i("#"+u).css("background-position","-123px -56px");var m={type:"Root",settings:{id:"Root",title:"All Items"},items:t.items,events:t.events};this.createTreeNode(m,0),i("#"+u).click((function(){var e=-1*d[s]/54,t=5;e<5&&(t=e),d[s]<0&&(d[s]+=54*t,i("#"+s).animate({left:d[s]/10+"em"}))})),i("#"+p).click((function(){var e=r[s]+d[s]/54,t=5;e-5<5&&(t=e-5),d[s]>-54*(r[s]-5)&&(d[s]-=54*t,i("#"+s).animate({left:d[s]/10+"em"}))}))},this.createTabContainer=function(e){var n=i.extend({id:"NotAvailable",position:"inline",target:"body",height:"100%",width:"100%",tabs:[{title:"Tab 1",content:i("<div>Content 1 Content 1 Content 1 Content 1 Content 1 </div>")},{title:"Tab 2",content:i("<div>Content 2 Content 2 Content 2 Content 2 Content 2</div>")}],selectedTab:0},e),o=this;this.handleClick=function(e){o.selectTab(i(this).data("index"))},this.selectTab=function(e){var t=a.children(".Tabs").children(".Tab").eq(n.selectedTab),i=a.children(".Tabs").children(".Tab").eq(e);if(t.data("index")!=i.data("index")){a.children(".Tabs").children(".Tab").removeClass("Selected");var o=a.children(".Contents").children(".Content").eq(t.data("index")),l=a.children(".Contents").children(".Content").eq(i.data("index")),s="right";t.data("index")<i.data("index")&&(s="left"),o.hide("slide",{direction:s},250),l.show("slide",{direction:"left"==s?"right":"left"},250),n.selectedTab=i.data("index"),i.addClass("Selected")}};var a="";n.selectedTab,"inline"==n.position&&(a=i('<div class="TabContainer" id="'+n.id+'"><div class="Tabs"></div><div class="Contents"></div></div>').appendTo(n.target)),i.each(n.tabs,(function(e,t){var n=i('<a class="Tab RoundedButtonMedium">'+this.title+"</a>").appendTo(a.children(".Tabs"));n.data("index",e),this.content.appendTo(i('<div class="Content"></div>').appendTo(a.children(".Contents"))),n.on("click",o.handleClick)})),this.selectFirstTab=function(){t.console("Showing first tab"),a.children(".Contents").children(".Content").eq(n.selectedTab).show(),a.children(".Tabs").children("a.Tab").eq(n.selectedTab).addClass("Selected")},runOrWhenDOMReady(this.selectFirstTab)},this.contextMenu=function(e){e=i.extend({container:i("body"),commands:[{label:"Copy",command:unbinded},{label:"Paste",command:unbinded},{label:"Delete",command:unbinded}],events:{onShow:i.noop}},e);var t=this;this.hide=function(){t.menu.fadeOut(200)},this.buildSubMenus=function(e,n,o){if(void 0!==e){var a=i('<ul class="SubMenu"></ul>').appendTo(n);o&&a.hide(),i.each(e,(function(e){var n=i("<li><a>"+this.label+"</a></li>").appendTo(a),o=this;void 0!==o.condition&&(o.condition()?n.removeClass("Disabled"):n.addClass("Disabled")),n.on("click",(function(e){void 0===o.subcommands?(void 0===o.condition||o.condition())&&(o.command(o.data),t.hide()):(n.children("ul").slideToggle(150),e.stopPropagation())})),t.buildSubMenus(this.subcommands,n,!0)}))}},this.menu=i('<div class="ContextMenu"></div>').appendTo("body"),this.commands=i('<div class="Commands"></div>').appendTo(this.menu),e.container.on("contextmenu",(function(n){return i(".ContextMenu").hide(),t.buildSubMenus(e.commands,t.commands.empty(),!1),t.menu.show(),t.menu.position({my:"left top",of:n,collision:"none"}),e.events.onShow(),!1})),i("body").on("click",(function(e){t.hide()}))},this.dialog=function(e){var t=i.extend({title:"Settings",width:800,height:500,container:"body",content:"",commands:{left:[],right:[{label:"Save",class:"SaveCommand",command:function(){alert("Unbinded")}}]},id:0},e);this.show=function(e){this.dialogDOM.find(".modal-dialog").css({width:"80%","margin-left":"auto","margin-right":"auto","max-width":t.width+"px"}),this.dialogDOM.modal("show")},this.hide=function(){this.dialogDOM.modal("hide")},this.getContentPlaceholder=function(){return this.dialogDOM.find(".Content").first()};var n=i('<div class="modal fade ORModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3>'+t.title+'</h3></div><div class="modal-body"><div class="Content">'+t.content+'</div></div><div class="modal-footer"><div class="left"></div><div class="right"></div><div class="clear-float"></div></div></div></div></div>').hide().prependTo(t.container);t.commands.left.length+t.commands.right.length==0&&n.find("modal-footer").remove();var o=n.find(".modal-footer");i.each(t.commands.left,(function(){i('<button class="btn '+(this.primary?"btn-primary":"")+' btn-lg">'+this.label+"</button>").appendTo(o.find(".left")).on({click:this.command})})),i.each(t.commands.right.reverse(),(function(){i('<button class="btn '+(this.primary?"btn-primary":"")+' btn-lg" '+(this.ngDisabled?'ng-model="button" ng-disabled="'+this.ngDisabled+'"':"")+">"+this.label+"</button>").appendTo(o.find(".right")).on({click:this.command})})),this.dialogDOM=n},this.settingsDialog=function(e){var n,o=i.extend({id:"",title:"Settings",commitChanges:!1},e),l=this;this.items={};var s=this.items;this.surveyId,this.settingsState={},this.hasChanged=!1,this.getContent=function(e){var t=i('<div class="TabContent SettingsDialog"></div>');switch(e){case"Presentation":var n=i('<div id="TitleAndMessagesPane"></div>').appendTo(t);s.introText=new a.textEditor({id:"SurveyIntro",container:n,label:g.SETTINGS_INTRO_TEXT+". <small>"+g.SETTINGS_INTRO_DESCRIPTION+"</small>",description:"Description of the command"}),s.closingText=new a.textEditor({id:"SurveyClosing",container:n,label:g.SETTINGS_CLOSING_TEXT+". <small>"+g.SETTINGS_CLOSING_DESCRIPTION+"</small>",description:"Description of the command"});break;case"Delivery":var o=i('<div id="DeliveryPane"></div>').appendTo(t),l=i('<div class="Publication"></div>').appendTo(o);new a.label({id:"PublicationLabel",container:l,label:g.SETTINGS_LABEL_PUBLICATION}),s.startDate=new a.dateTime({id:"StartDeliveryOn",container:l,label:g.SETTINGS_START_DATE,description:"Description of the command",controlClass:"form-control"}),s.endDate=new a.dateTime({id:"EndDeliveryOn",container:l,label:g.SETTINGS_END_DATE,description:"Description of the command",controlClass:"form-control"}),s.status=new a.selector({id:"StatusSelector",container:l,options:T,label:g.SETTINGS_SURVEY_STATUS,description:"Description of the command"});var d=i('<div class="Serving"></div>').appendTo(o);new a.label({id:"ServingLabel",container:d,label:g.SETTINGS_LABEL_SERVING}),s.enableItemRandomize=new a.checkbox({id:"EnableItemRandomize",container:d,label:g.SETTINGS_ENABLE_ITEM_RANDOMIZE,description:"Description of the command"}),s.enableOptionRandomize=new a.checkbox({id:"EnableOptionRandomize",container:d,label:g.SETTINGS_ENABLE_OPTION_RANDOMIZE,description:"Description of the command"}),s.showHiddenItemsAsDisabled=new a.checkbox({id:"ShowHiddenItemsAsDisabled",container:d,label:g.SETTINGS_ENABLE_HIDDEN_ITEMS_VISIBLE,description:"Description of the command"});var r=i('<div class="Navigation"></div>').appendTo(o);new a.label({id:"NavigationLabel",container:r,label:g.SETTINGS_LABEL_NAVIGATION}),s.scrollingMode=new a.selector({id:"ScrollingMode",container:r,options:y,label:g.SETTINGS_SCROLLING_MODE,description:"Description of the command"}),s.visibleItems=new a.spinner({id:"SmartScrollingVisibleItems",container:r,minValue:1,fastIncrement:5,label:g.SETTINGS_VISIBLE_ITEMS,value:15});var c=i('<div class="Appearance"></div>').appendTo(o);new a.label({id:"AppearanceLabel",container:c,label:g.SETTINGS_LABEL_APPEARANCE}),s.template=new a.selector({id:"SurveyTemplate",container:c,options:k,label:g.SETTINGS_TEMPLATE}),s.theme=new a.selector({id:"SurveyTheme",container:c,options:E,label:g.SETTINGS_THEME});var h=i('<div class="Objectives"></div>').appendTo(o);new a.label({id:"ObjectivesLabel",container:h,label:g.SETTINGS_LABEL_OBJECTIVES}),s.maxResponsesPerDay=new a.spinner({id:"MaxResponsesPerDay",container:h,zeroIsUnlimeted:!0,minValue:0,maxValue:1e3,fastIncrement:10,label:g.SETTINGS_MAX_RESPONSES_PER_DAY,suffix:g.SETTINGS_RESPONSES}),s.maxResponsesTotal=new a.spinner({id:"MaxResponsesTotal",container:h,zeroIsUnlimeted:!0,minValue:0,maxValue:1e4,fastIncrement:100,label:g.SETTINGS_MAX_RESPONSES_TOTAL,suffix:g.SETTINGS_RESPONSES}),s.deliveryStrategy=new a.selector({id:"DeliveryStrategy",container:h,options:C,label:g.SETTINGS_DELIVERY_STRATEGY});break;default:i('<div class="ComingSoon">Coming soon...</div>').appendTo(t)}return t},this.loadUI=function(){var e=(n=new a.dialog({width:800,height:250,title:o.title,content:"",commands:{left:[{label:I.DISCARD,class:"CancelCommand",command:l.discard}],right:[{label:o.commitChanges?I.SAVE:I.DONE,primary:!0,class:"SaveCommand",command:l.save}]}})).getContentPlaceholder();new a.createTabContainer({id:"SettingsTabs",target:e,tabs:[{title:"Presentation",content:l.getContent("Presentation")},{title:"Delivery",content:l.getContent("Delivery")}],selectedTab:0})},this.show=function(){n.show()},this.load=function(e){var n=getObjectKeys(e);t.console({text:"LOADING SETTINGS: "}),i.each(n,(function(){void 0!==s[this]?(t.console(this+": "+e[this]),s[this].setValue(e[this])):t.console({error:!0,text:"Cant set "+this+" as "+e[this]})}))},this.updateState=function(){var e=getObjectKeys(s);i.each(e,(function(){l.settingsState[this]=s[this].getValue(),t.console(this+" - val: "+l.settingsState[this])}))},this.save=function(e){if(t.console("Saving settings..."),l.updateState(),o.commitChanges){var a=JSON.stringify(settingsState);i.ajax({url:"/api/survey/settings/"+surveyId,cache:!1,type:"POST",data:a,contentType:"application/json; charset=utf-8",statusCode:{202:function(e){i(g.SAVE_SUCCESS).notify({autoHide:3e3}),l.hasChanged=!1,n.hide()},200:function(e){i().notify({title:g.SAVE_ERROR,autoHide:3e3,message:e,type:"Error"})}},error:function(e,t,i){alert("Service call failed: "+e+" - "+t+" - "+i)}})}else l.hasChanged=!0,n.hide()},this.discard=function(e,t){n.hide()}}}function H(e,t){var i=new b($);i.console("... Booting Survey Editor"),P={},void 0===M&&(M=new V($,i)),i.console("... Booting controller"),A=new U(t),i.console("... Booting survey"),A.init(),A.id=$("surveyId").getURLParameter(),A.shortId=A.id,i.console("... Booting Editor Area"),N=new B(t),i.console("... Initing Editor Area"),N.init(),i.console("... Editor Area ready "),""!==A.id?i.console("... Setting up Survey"):i.console("... Creating New Survey")}function U(e){var t=this;this.saved=!1,this.firstItem=!0,this.onLoadError=function(){},this.onSaveError=function(){},this.init=function(){P.id="",P.title=g.NEW_SURVEY_TITLE},this.load=function(e){A.shortId=e.shortId,N.loadSurvey(e),N.loadSettings(e.settings),N.updateAutoSave()},this.save=function(i,n){if("function"==typeof e.onSurveySave){var o=N.getSurvey();e.onSurveySave(o,(function(){"function"==typeof i&&i(o)}),(function(e){t.onSaveError(e,n)}))}}}function B(e){var t=new b($);this.surveyHasChanged=!0;this.selectedItems=[],this.clipboard={},this.clipboardOption=0,this.undoStack=[],this.redoStack=[],this.currentState,this.buttons={},this.dialogs={},this.header={},this.board=$("#SurveyEdition"),this.autoSave=!1,this.autoSaveTimer=-1;var i=["DropDown","RadioText","RadioImage","RadioVideo","RadioHTML","ListText","ListImage","ListVideo","ListHTML","BinaryYesNo","BinaryTrueFalse","ListCheck","RateRadioText","RateRadioImage","RateRadioVideo","RateRadioHTML","OpenSingleLine","OpenMultipleLine","OpenRichText","Label","Matrix","Group"];this.showHelp=function(){return!1},this.init=function(){this.dialogs.surveySettings=new M.settingsDialog({title:"Survey Settings"}),t.console("Creating settings dialog"),this.dialogs.surveySettings.loadUI(),t.console("dialog settings loaded."),this.dialogs.surveyPreview=new M.dialog({title:"Survey Preview",width:1e3,height:600,commands:{left:[],right:[]}}),this.dialogs.publish=new M.dialog({title:g.PUBLISH_TITLE,commands:{right:[{label:g.DONE,class:"SaveCommand",primary:!0,command:function(){N.dialogs.publish.hide()}}],left:[]}}),this.dialogs.displayRules=new M.dialog({title:g.DISPLAY_RULES_TITLE,commands:{right:[{label:g.DONE,class:"SaveCommand",primary:!0,command:function(){N.dialogs.displayRules.hide()}}],left:[]}}),$("#SurveyEditorToolbar, #SurveyEdition").empty(),M.toolbar({scrollable:!0}),M.toolbarGroup({id:"File",title:g.MENU_PANEL_SURVEY,width:"20%"}),M.toolbarGroup({id:"Items",title:g.MENU_PANEL_ITEMS,width:"39%"}),M.toolbarGroup({id:"Clipboard",title:g.MENU_PANEL_CLIPBOARD,width:"9%"}),M.toolbarGroup({id:"Properties",title:g.MENU_PANEL_PROPERTIES,width:"32%",visible:!1}),M.button({id:"Save",toolbarId:"File",text:"Save",command:A.save,horizontal:!1,width:"3.5em",height:"4em",positionX:"0.5em",positionY:"0.7em",texturePositionX:-592,texturePositionY:-5}),N.buttons.autoSave=new M.checkbox({id:"AutoSave",toolbarId:"File",label:"Auto",width:"3.5em",positionX:"0.2em",positionY:"5.2em",command:N.handleAutoSave}),t.console("editor.autoSave "+N.autoSave),N.buttons.autoSave.setValue(N.autoSave,{skipEvents:!0}),""===A.id&&N.updateAutoSave(),M.button({id:"Settings",toolbarId:"File",text:"Settings",command:N.dialogs.surveySettings.show,width:"5em",positionY:"0.7em",positionX:"4.5em",texturePositionY:-90}),M.button({id:"Preview",toolbarId:"File",text:"Preview",command:N.handlePreview,width:"5em",positionY:"2.8em",positionX:"4.5em",texturePositionY:-387}),M.button({id:"GetCode",toolbarId:"File",text:g.MENU_PANEL_GET_CODE,command:N.handlePublish,width:"5em",positionY:"4.9em",positionX:"4.5em",texturePositionY:-417}),N.buttons.undo=new M.button({id:"Undo",toolbarId:"File",text:"Undo",command:N.undo,enabled:!1,horizontal:!1,width:"4em",height:"4em",positionY:"0.7em",positionX:"10.2em",texturePositionX:-590,texturePositionY:-58}),N.buttons.redo=new M.button({id:"Redo",toolbarId:"File",text:"Redo",command:N.redo,enabled:!1,width:"4em",positionY:"5.0em",positionX:"10.2em",texturePositionY:-197}),M.button({id:"Cut",toolbarId:"Clipboard",text:"Cut",command:N.handleCut,width:"5em",positionX:"0.5em",positionY:"0.7em",texturePositionY:-22}),M.button({id:"Copy",toolbarId:"Clipboard",text:"Copy",command:N.handleCopy,width:"5em",positionX:"0.5em",positionY:"2.8em",texturePositionY:0}),N.buttons.paste=new M.button({id:"Paste",toolbarId:"Clipboard",enabled:!1,text:"Paste",width:"5em",positionX:"0.5em",positionY:"4.9em",texturePositionY:-44}),M.treeSelector({id:"ItemChooser",toolbarId:"Items",title:"Insert Item",text:"Description of Inserting",items:[{type:"Choice",settings:{id:"Choice",texturePositionX:"-186px",texturePositionY:"-586px"},items:[{type:"DropDown",settings:{id:"DropDown",texturePositionX:"-186px",texturePositionY:"-5px"},items:[]},{type:"Radio",settings:{id:"RadioText",texturePositionX:"-186px",texturePositionY:"-586px"},items:[]},{type:"List",settings:{id:"ListText",texturePositionX:"-286px",texturePositionY:"-586px"},items:[]}]},{type:"Binary",settings:{id:"Binary",texturePositionX:"-186px",texturePositionY:"-88px"},items:[{type:"BinaryYesNo",settings:{id:"BinaryYesNo",title:"Yes/No",texturePositionX:"-186px",texturePositionY:"-88px"},items:[]},{type:"BinaryTrueFalse",settings:{id:"BinaryTrueFalse",title:"True/False",texturePositionX:"-386px",texturePositionY:"-88px"},items:[]},{type:"ListCheck",settings:{id:"ListCheck",title:"Check",texturePositionX:"-486px",texturePositionY:"-88px"},items:[]}]},{type:"SortRate",settings:{id:"SortRate",title:"Sort/Rate",texturePositionX:"-286px",texturePositionY:"-255px"},items:[]},{type:"Open",settings:{id:"Open",texturePositionX:"-186px",texturePositionY:"-170px"},items:[{type:"OpenSingleLine",settings:{id:"OpenSingleLine",title:"1-Line",texturePositionX:"-186px",texturePositionY:"-170px"},items:[]},{type:"OpenMultipleLine",settings:{id:"OpenMultipleLine",title:"Multi-Line",texturePositionX:"-286px",texturePositionY:"-170px"},items:[]},{type:"OpenRichText",settings:{id:"OpenRichText",title:"Rich Text",texturePositionX:"-386px",texturePositionY:"-170px"},items:[]}]},{type:"Label",settings:{id:"Label",texturePositionX:"-186px",texturePositionY:"-424px"},items:[]},{type:"Matrix",settings:{id:"Matrix",enabled:!0,texturePositionX:"-186px",texturePositionY:"-338px"},items:[]},{type:"Group",settings:{id:"Group",enabled:!0,texturePositionX:"-186px",texturePositionY:"-504px"},items:[]}],width:"29em",positionY:"0.5em",events:{clickNode:N.handleInsertAtTheEnd}}),N.board.addClass("DragArea"),N.createInsert(N.board,!0),N.showHelp()&&popOver({element:"#Items",title:frontendStrings.pages.editor.help.insertItem.title,content:frontendStrings.pages.editor.help.insertItem.content,placement:"right"})},this.loadSettings=function(e){this.dialogs.surveySettings.load(e)},this.loadHeaderAndStyle=function(e){},this.loadSurvey=function(e,t){N.loadHeaderAndStyle(e),e.items.length>0?(N.startSurveyEdition(),N.loadChildren(e),null==t&&N.updateDeletedItemsFromModel(e),N.updateParentFromModel(e),N.updateOrderFromModel(e)):N.restartSurveyEditor(!0)},this.refreshSelectedItems=function(){N.loadChildren(N.getSurvey())},this.loadChildren=function(e,i){null==i&&(i={id:"0"}),$(e.items).filter((function(e){return this.parentItemId==i.id})).each((function(n,o){t.console("Restoring "+o.itemType+": "+o.cell.y+","+o.cell.x);var a=void 0,l=!1;N.board.find("#RenderedItem"+o.id).size()?l=!0:"0"!=i.id&&(t.console("Loading Element "+o.itemType+" and parent "+i.id),a=N.board.find("#RenderedItem"+i.id).children(".Item").children(".ItemContainer").children(".MatrixTable").children("tbody").children("tr").eq(o.cell.y).children("td").eq(o.cell.x).children(".SurveyInsert").last()),N.renderItem({id:o.id,type:o.itemType,model:o,containingElement:a,select:!1,replace:l},this),N.loadChildren(e,o)}))},this.updateDeletedItemsFromModel=function(e){var t=$.map(e.items,(function(e,t){return e.id}));$(".RenderedItem").each((function(e,i){$.inArray($(this).data("itemData").id,t)<0&&N.removeItem(this,"skipUndo")}))},this.updateParentFromModel=function(e){$.each(e.items,(function(e,t){var i=N.board.find("#RenderedItem"+t.id),n=N.getItemCell(i);if(N.getParentItemId(i)!=t.parentItemId||t.cell.x!=n.x||t.cell.y!=n.y){var o=N.getTableCell(t,0);i.next().insertAfter(o),i.insertAfter(o)}}))},this.updateOrderFromModel=function(e){$.each(e.items,(function(e,t){var i=N.board.find("#RenderedItem"+t.id),n=N.getTableCell(t);n.next().is(i)||$(i).swap(n.next())}))},this.startSurveyEdition=function(e){t.console("Survey edition has started"),N.board.removeClass("DragArea"),N.board.filter(".SurveyInsert").removeClass("SurveyStartLegend"),A.firstItem=!1},this.restartSurveyEditor=function(e){t.console("Restarting survey"),N.board.addClass("DragArea"),!0===e&&N.board.find(":not(.SurveyInsert:first)").remove(),N.board.filter(".SurveyInsert").addClass("SurveyStartLegend"),A.firstItem=!0},this.renderItem=function(e,i){var n=$.extend({id:"",type:"unset",containingElement:void 0,model:{},select:!0,replace:!1},e);switch(n.type){case"Choice":case"Radio":n.type="RadioText";break;case"List":n.type="ListText";break;case"Binary":n.type="BinaryYesNo";break;case"Open":n.type="OpenSingleLine";break;case"SortRate":n.type="RateRadioText"}var o=n.model;null==n.containingElement&&(n.containingElement=N.board.children(".SurveyInsert").last());var s,d=""!=n.id?n.id:t.randomId(),r=null!=o.itemType?o.itemType:n.type,c=N.parentItemType(r);if(n.replace){if(s=N.board.find("#RenderedItem"+d),"Matrix"!=r){if(areEqual(i,s.data("itemData")))return void t.console("@ Item does not needs updating");s.find(".Item").first().empty()}else if("Group"!=r){var h=s.data("widget");return h.setRowCount(o.matrix.rows),h.setColumnCount(o.matrix.cols),h.getColumns(h.getRows().first()).each((function(e){$(this).data("cellDimension",o.matrix.widths[e])})),void h.refreshWidths({animate:!1})}if($.extend({id:"0"},s.parentsUntil(".RenderedItem, #SurveyEdition").data("itemData")).id!=o.parentItemId){var u=s.next().detach(),p=s.detach();"0"!=o.parentItemId?N.board.find("#RenderedItem"+o.parentItemId).data("widget").getCell(o.cell.y,o.cell.x).append(p).append(u):N.board.find("SurveyEdition").append(p).append(u)}else if("0"!=o.parentItemId){var m=N.getItemCell(s);m.x==o.cell.x&&m.y==o.cell.y||(u=s.next().detach(),p=s.detach(),N.board.find("#RenderedItem"+o.parentItemId).data("widget").getCell(o.cell.y,o.cell.x).append(p).append(u))}}else t.console("Creating item "+r),s=$('<div class="RenderedItem" id="RenderedItem'+d+'"><div class="Item"></div></div>').insertAfter(n.containingElement),N.createInsert(s);var v=s.find(".Item");"Matrix"!=r&&"Group"!=r&&s.droppable({drop:this.handleItemSwap,hoverClass:"ItemContainerHover",accept:".RenderedItem"}),s.draggable({distance:10,containment:"body",cursorAt:{top:40,left:50},cursor:"move",helper:function(){return'<div class="SurveyDraggingItem">'+$("#"+r).parent().html()+'<div class="Legend">'+tr(I.DRAGGING_EXISTING,r)+"</div></div>"},revert:"invalid",revertDuration:150,zIndex:10}),s.on("click",{},(function(e){N.selectItem(this),e.stopPropagation(),t.documentClick()}));var f=$.extend({id:"0"},n.containingElement.closest(".RenderedItem, #SurveyEdition").data("itemData")),b=o.layout;if(null==b&&(b=void 0===N.lastLayout?"Right":N.lastLayout,"Matrix"==f.itemType)){var S=s.closest("td");S.prev().length>0&&S.closest("tr").prev().length>0&&(b="NoLabel")}var g=null!=o.orientation?o.orientation:"Binary"==c?"Horizontal":"Vertical",E=$('<div class="ItemContainer '+r+" "+b+" "+g+'"></div>').appendTo(v);switch(o=$.extend(!0,{required:!1,visibility:{inverted:!1,rules:[]},choice:{options:[],multiSelect:"List"===c,showIcon:!0,other:{show:!1,label:a,hint:l}},open:{size:"Medium HMedium",defaultText:""},rate:{levels:3,headerStyle:"EachCell",headerLabels:"",headerCategory:void 0}},o),r){case"Label":s.data("widget",new N.ui.label({label:o.label,container:E}));break;case"DropDown":o.choice=$.extend({options:{}},o.choice),s.data("widget",new N.ui.dropDown({label:o.label,options:o.choice.options,required:o.required,container:E,layout:b}));break;case"RadioText":case"RadioImage":case"RadioVideo":case"RadioHTML":case"ListText":case"ListImage":case"ListVideo":case"ListHTML":case"BinaryYesNo":case"BinaryTrueFalse":case"ListCheck":o.choice=$.extend({options:[]},o.choice),s.data("widget",new N.ui.listChoice({type:r,label:o.label,required:o.required,options:o.choice.options,container:E,multiSelect:o.choice.multiSelect,showIcon:o.choice.showIcon,layout:b,other:o.choice.other}).widget);break;case"Matrix":case"Group":var T=2,C=2;"Group"==r&&(T=C=1),o.matrix=$.extend({rows:T,cols:C,widths:[{dimension:0,unit:"Percent"},{dimension:0,unit:"Percent"}]},o.matrix),o.matrix.rows,o.matrix.cols,o.matrix.widths,s.data("widget",new N.ui.matrix({container:E,rows:o.matrix.rows,cols:o.matrix.cols,widths:o.matrix.widths,showToolbars:"Matrix"==r}));break;case"OpenSingleLine":case"OpenMultipleLine":case"OpenRichText":s.data("widget",new N.ui.open({type:r,label:o.label,container:E,required:o.required,open:o.open,multipleLine:!1,richText:!1}));break;case"RateRadioText":case"RateRadioImage":case"RateRadioVideo":case"RateRadioHTML":o.choice=$.extend({options:[]},o.choice),s.data("widget",new N.ui.rank({type:r,label:o.label,container:E,levels:o.rate.levels,headerStyle:o.rate.headerStyle,headerLabels:o.rate.headerLabels,headerCategory:o.rate.headerCategory,options:o.choice.options,required:o.required}).widget);break;default:v.html("<div>Item <b>"+r+"</b> not implemented</div>")}return $('<div style="clear: both"></div>').appendTo(E),new M.contextMenu({container:s,commands:[{label:"Cut",command:N.handleCut},{label:"Copy",command:N.handleCopy},{label:"Paste",command:N.handleReplace,condition:N.clipboardSize},{label:"Paste Rules",command:N.handleReplaceRules,condition:N.clipboardSize},{label:"Convert To",command:$.noop,subcommands:N.getConvertableCommands(r)},{label:"Delete",command:N.remove}],events:{onShow:function(e){N.selectItem(s)}}}),s.data("itemData",{id:d,itemType:n.type,title:n.type,parentItemId:0,visibility:o.visibility,layout:b,orientation:g,required:o.required,choice:o.choice,open:o.open,rate:o.rate}),n.select&&N.selectItem(s),s},this.getConvertableCommands=function(e){var t,n={};switch($.each(i,(function(e,t){n[t]={label:g[t+"_NAME"],command:N.handleChangeItemType,data:{targetType:t}}})),e){case"Label":case"DropDown":case"RadioText":case"RadioImage":case"RadioVideo":case"RadioHTML":case"ListText":case"ListImage":case"ListVideo":case"ListHTML":case"BinaryYesNo":case"BinaryTrueFalse":case"ListCheck":t=$(i).filter((function(){return this!=e&&"Matrix"!=this&&"Label"!=this&&"ListCheck"!=this&&"Group"!=this&&"Open"!=N.parentItemType(this)})).map((function(){return n[this]})).get()}return t},this.handleAutoSave=function(){N.autoSave=N.buttons.autoSave.getValue(),N.updateAutoSave(),"function"==typeof e.onToggleAutoSave&&e.onToggleAutoSave(N.autoSave)},this.updateAutoSave=function(){N.autoSave?N.autoSaveTimer=setInterval((function(){A.save(!1,!0)}),6e4):N.autoSaveTimer>=0&&clearInterval(N.autoSaveTimer)},this.handleChangeItemType=function(e){t.console("Changing item to "+e.targetType);var i=N.getSurvey(),n=[];$.each(N.getSelectedItems(),(function(t,o){var a=$(o).data("itemData").id;n.push($(i.items).filter((function(t){return this.id==a&&(i.items[t].itemType=e.targetType,!0)})).get()[0])})),i.items=n,N.loadChildren(i),N.showProperties()},this.createInsert=function(e,t){null==e&&(e=N.board.children(".RenderedItem").last());var i,n='<div class="SurveyInsert">'+g.INSERT_NEW_ITEM+'<div class="PasteLegend">'+g.INSERT_NEW_ITEM_PASTE+"</div></div>";return(i=null==t?$(n).insertAfter(e):$(n).appendTo(e)).droppable({drop:N.handleItemInsert,hoverClass:"ItemContainerHover",accept:".Item, .RenderedItem"}),i.on({mouseenter:function(e){N.clipboardSize()>0&&$(this).addClass("ShowPaste")},mouseleave:function(e){$(this).removeClass("ShowPaste")},click:function(e){N.clipboardSize()>0&&N.paste(i)}}),i},this.handleItemSwap=function(e,t){N.swapItems(t.draggable,$(this))},this.swapItems=function(e,t){$(e).swap(t)},this.handleItemInsert=function(e,t){if($(t.draggable).hasClass("RenderedItem")){if($(t.draggable).next().is($(this))||$(this).next().is(t.draggable))return;N.moveItem($(this),t.draggable)}else N.insertItem({containingElement:$(this),type:t.draggable.attr("id")})},this.handleInsertAtTheEnd=function(e){t.console("Insert Item: "+e.itemType),N.insertItem({containingElement:N.board.children(".SurveyInsert:last"),type:e.itemType}),$("body").animate({scrollTop:$("body").prop("scrollHeight")},{queue:!1,duration:600,easing:"linear"})},this.moveItem=function(e,t){$(t).next().insertAfter(e),$(t).insertAfter(e)},this.insertItem=function(e){null==e.containingElement&&(e.containingElement=$(".SurveyInsert").last());var t=A.firstItem;A.firstItem&&N.startSurveyEdition();var i=N.renderItem(e);return t&&N.showHelp()&&popOverTour([{element:".RenderedItem:first",title:frontendStrings.pages.editor.help.selectItem.title,content:frontendStrings.pages.editor.help.selectItem.content,placement:"top"},{element:"#Properties",title:frontendStrings.pages.editor.help.itemProperties.title,content:frontendStrings.pages.editor.help.itemProperties.content,placement:"bottom"},{element:"#GetCode",title:frontendStrings.pages.editor.help.publish.title,content:frontendStrings.pages.editor.help.publish.content,placement:"bottom"}]),i},this.removeItem=function(e){$(e).next().remove(),$(e).remove(),0==N.board.find(".RenderedItem").size()&&N.restartSurveyEditor()},this.addUndoOperation=function(e){t.console("adding undo (stored: "+e==!0+")"),N.undoStack.push(!0===e?N.currentState:N.getSurvey()),1==N.undoStack.length&&N.buttons.undo.setEnabled(!0)},this.storeCurrentState=function(){t.console("Storing current state"),N.currentState=N.getSurvey()},this.registerMethodForUndoOperation=function(e){var i=this[e];this[e]=function(e,i){return function(){var e;return"skipUndo"!==arguments[arguments.length-1]?(N.addUndoOperation(),e=i.apply(this,arguments),N.surveyChanged()):(t.console("Skipping undo"),arguments[arguments.length-1]=void 0,e=i.apply(this,arguments)),e}}(0,i)},this.undo=function(){if(N.undoStack.length>0){N.redoStack.push(N.getSurvey());var e=N.undoStack.pop();N.loadSurvey(e),t.console("Redo stack: "+N.redoStack.length),1==N.redoStack.length&&N.buttons.redo.setEnabled(!0)}0==N.undoStack.length&&N.buttons.undo.setEnabled(!1),N.showProperties()},this.redo=function(){if(N.redoStack.length>0){var e=N.redoStack.pop();N.addUndoOperation(),N.loadSurvey(e)}0==N.redoStack.length&&N.buttons.redo.setEnabled(!1),N.showProperties()},this.clearRedoStack=function(){N.redoStack=[],N.buttons.redo.setEnabled(!1)},this.handleCut=function(){N.getSelectedItems().length>0&&N.cut()},this.cut=function(){N.clipboardOption=1,N.cutOrCopy()},this.handleCopy=function(){N.getSelectedItems().length>0&&N.copy()},this.copy=function(){N.clipboardOption=2,N.cutOrCopy()},this.cutOrCopy=function(){N.updateSurveyModel(),N.clipboard=$.map(N.getSelectedItems(),(function(e,t){var i=$(e).data("itemData");return 1==N.clipboardOption&&N.removeItem($("#RenderedItem"+i.id),"skipUndo"),i})),N.buttons.paste.setEnabled(!0)},this.handlePaste=function(e){N.clipboard.length>0&&N.paste()},this.paste=function(e){N.startSurveyEdition(),$.each(N.clipboard,(function(t,i){N.renderItem({type:i.itemType,containingElement:e,model:i})})),1==N.clipboardOption&&N.clearClipboard()},this.handleReplace=function(){N.selectedItems.length>0&&N.replace()},this.handleReplaceRules=function(){$.each(N.getSelectedItems(),(function(e,t){$.each(N.clipboard,(function(e,i){$(t).data("itemData").visibility=i.visibility}))})),N.showProperties(),1==N.clipboardOption&&N.clearClipboard()},this.replace=function(){var e=$("#RenderedItem"+N.selectedItems[0]).prev();N.remove("skipUndo"),N.paste(e,"skipUndo")},this.clearClipboard=function(){N.clipboard=[],N.buttons.paste.setEnabled(!1)},this.clipboardSize=function(){return N.clipboard.length},this.surveyChanged=function(){N.clearRedoStack(),N.surveyHasChanged=!0,"function"==typeof e.onSurveyChanged&&e.onSurveyChanged()},this.handlePreview=function(){t.console("Previewing survey");var e=N.dialogs.surveyPreview.getContentPlaceholder();e.attr("id","surveyPreview"+t.randomId()),e.wrap('<div class="Preview"></div'),N.dialogs.surveySettings.updateState(),N.dialogs.surveySettings.hasChanged=!0;var i={testMode:!0,surveyId:"surveyPreview"+t.randomId(),containerId:e.attr("id"),height:290,controlClass:"form-control",data:N.getSurvey(),animation:{show:{delay:250}}};OverResponse.respondant.launchSurvey(i),N.dialogs.surveyPreview.show()},this.handlePublish=function(){""==A.id?A.save(N.showPublish):N.showPublish()},this.handleEditDisplayRules=function(){t.console("Showing the Display Rules");var e=N.dialogs.displayRules.getContentPlaceholder();e.empty(),$('<h4><div><div id="DisplayRuleMain"></div><div class="DisplayRulesIntro">'+g.DISPLAY_RULES_MAIN_ACTION+"<div></div></h4>").appendTo(e),$('<div class="GenericSpacer" />').appendTo(e);var i=$('<div class="RulesContainer"></div>').appendTo(e),n=$('<div class="alert alert-error"><h4>'+g.DISPLAY_RULES_NONE_TITLE+"</h4>"+g.DISPLAY_RULES_NONE_MSG+"</div>").appendTo(e);$("<h4>"+g.DISPLAY_RULES_SELECT+"</h4>").appendTo(e),$('<div id="DisplayRulePreview"></div>').appendTo(e);var o=N.getSelectedItems()[0],a=$(o).data("itemData");new M.selector({id:"DisplayRuleMainSelector",container:$("#DisplayRuleMain"),options:[{label:g.DISPLAY_RULES_MAIN_ACTION_SHOW,html:g.DISPLAY_RULES_MAIN_ACTION_SHOW_DESCRIPTION},{label:g.DISPLAY_RULES_MAIN_ACTION_HIDE,html:g.DISPLAY_RULES_MAIN_ACTION_HIDE_DESCRIPTION}],command:function(e){a.visibility.inverted="Hide"===e}}).setValue(a.visibility.inverted?"Hide":"Show"),N.dialogs.surveySettings.updateState(),N.dialogs.surveySettings.hasChanged=!0;var l="surveyPreview"+t.randomId(),s={testMode:!0,surveyId:l,containerId:"DisplayRulePreview",height:250,scrollingMode:"Classic",template:"ButtonLess",hideCommands:!0,data:N.getSurvey()};function d(){0==a.visibility.rules.length?(i.css("display","none"),n.css("display","block")):(i.css("display","block"),n.css("display","none"),i.empty(),$.each(a.visibility.rules,(function(e){var t=$('<div class="RuleContainer"><div class="ORCondition"><span class="badge badge-important">'+g.DISPLAY_RULES_OR+'</span></div><div class="RemoveRule Iconset"></div></div>').appendTo(i);t.find(".RemoveRule").click((function(){a.visibility.rules.splice(e,1),d()})),$.each(this.ruleSet,(function(e,i){var n=N.getItemByIdFromModel(N.getSurvey(),e);$.isArray(i)?i=i.join(", "):"object"==typeof i&&(i=$.map(i,(function(e,t){return t+"/"+(e>=0?e:g.DISPLAY_RULES_UNASSIGNED)})).join(", ")),$('<div class="SingleRule">'+tr(g.DISPLAY_RULES_ITEM,n.label,i)+'<div class="ORCondition"><span class="badge badge-warning">'+g.DISPLAY_RULES_AND+"</span></div></div>").appendTo(t)}))}))),N.showProperties()}OverResponse.respondant.launchSurvey(s),$('<div class="GenericSpacer" />').appendTo(e),$('<div><div style="float: left"><button id="ResetSingleRuleButton" class="btn btn-small" type="button">'+g.DISPLAY_RULES_CLEAR_RULE+'</button></div><div style="float: right"><button id="SaveSingleRuleButton" class="btn btn-small btn-primary" type="button">'+g.DISPLAY_RULES_ADD_RULE+"</button></div>").appendTo(e),$('<div class="GenericSpacer" />').appendTo(e),d(),$("#SaveSingleRuleButton").click((function(){var e=OverResponse.respondant.getResponses(l);t.c(e),0==$.map(e,(function(e,t){return t})).length?notify({type:"Error",message:g.DISPLAY_RULES_EMPTY}):(a.visibility.rules.push({inverted:!1,ruleSet:e}),OverResponse.respondant.resetResponses(l),notify(g.DISPLAY_RULES_ADDED),$(o).data("itemData",a)),d()})),$("#ResetSingleRuleButton").click((function(){OverResponse.respondant.resetResponses(l)})),N.dialogs.displayRules.show()},this.showPublish=function(){t.console("Getting the code for survey");var e=N.dialogs.publish.getContentPlaceholder();e.empty(),e.append('<h3><span class="PublishOption">1</span>'+g.PUBLISH_SHARE_A_LINK+"</h3>"),e.append('<div><div class="PublishContainer">'+g.PUBLISH_SHARE_A_LINK_DESCRIPTION+"</div></div>");var i="https://su.rvey.me/"+A.shortId;$('<div><div class="PublishContainer"><textarea class="CodePlaceholder PublishLink form-control">'+i+"</textarea></div></div>").appendTo(e),e.append('<div><div class="PublishContainer">'+g.PUBLISH_TRY_SURVEY+': <a href="'+i+'" target="_blank">'+i+"</a></div></div>"),e.append('<h3><span class="PublishOption">2</span>'+g.PUBLISH_USE_API+"</h3>"),e.append('<div><div class="PublishContainer">'+g.PUBLISH_USE_API_DESCRIPTION+': <a href="//docs.overresponse.com/" target="_blank">docs.overresponse.com</a></h4></div></div>'),$(".CodePlaceholder").on("click",(function(){$(this).select()})),N.dialogs.publish.show()},this.unselectItems=function(e){$(".RenderedItem").removeClass("Selected");var t=$("#Properties");t.find(".Fields").empty(),e&&t.fadeOut(100)},this.selectItem=function(e){$(e).hasClass("Selected")||(N.unselectItems(!1),$(e).addClass("Selected"),N.selectedItems=[],N.selectedItems.push($(e).data("itemData").id),N.showProperties(e))},this.handleLayoutSelect=function(e){$.each(N.getSelectedItems(),(function(t,i){var n=$(i).data("itemData");n.layout=e,$(i).data("itemData",n);var o=$(i).find(".ItemContainer:first");o.hasClass("Top")||"Top"!=e?o.hasClass("Top")&&"Top"!=e&&$(o.find(".LabelContainer")).swap(o.find(".UIElement")):$(o.find(".UIElement")).swap(o.find(".LabelContainer")),o.removeClass("Top Bottom Left Right NoLabel"),o.addClass(e)})),N.lastLayout=e},this.handleOrientationSelect=function(e){$.each(N.getSelectedItems(),(function(t,i){var n=$(i).data("itemData");n.orientation=e,$(i).data("itemData",n);var o=$(i).find(".ItemContainer");o.removeClass("Horizontal Vertical"),o.addClass(e)}))},this.handleHeaderStyleSelect=function(e){$.each(N.getSelectedItems(),(function(t,i){var n=$(i).data("itemData");n.rate.headerStyle=e,$(i).data("itemData",n);var o=$(i).find(".ItemContainer");o.removeClass("TwoLabels ThreeLabels EachCell OnlyAttributeHeader NoHeadings"),o.addClass(e),$(i).data("itemData").rate.headerStyle=e,$(i).data("widget").setHeaderStyle(e)}))},this.handleChangeSize=function(e){$.each(N.getSelectedItems(),(function(t,i){$(i).data("itemData").open.size=e,$(i).find(".InputItem:first, .TextAreaItem:first, .TextEditor:first").removeClass("Small Medium Large Maximum HSmall HMedium HLarge").addClass(e)}))},this.handleChoiceMultiSelect=function(e){$.each(N.getSelectedItems(),(function(t,i){$(i).data("itemData").choice.multiSelect=e}))},this.handleRequired=function(e){$.each(N.getSelectedItems(),(function(t,i){$(i).data("itemData").required=e}))},this.handleShowHideBinaryIcon=function(e){$.each(N.getSelectedItems(),(function(t,i){$(i).data("itemData").choice.showIcon=e;var n=$(i).find(".Options:first");e?n.removeClass("IconLess"):n.addClass("IconLess")}))},this.handleChangeRateScale=function(e){var i=parseInt(e);t.console("RateScale - New total: "+i),$.each(N.getSelectedItems(),(function(e,t){$(t).data("itemData").rate.levels=i,$(t).data("widget").setLevels(i)}))},this.handleHasOther=function(e){t.console("Add/Remove Other Field "+e),$.each(N.getSelectedItems(),(function(t,i){$(i).data("itemData").choice.other.show=e,$(i).data("widget").setOther(e)}))},this.handleChangeTheme=function(e){t.console("Changing theme to "+e),$("head").append('<link rel="stylesheet" type="text/css" href="/stylesheets/respondant/themes/'+e+'/default.css" />')},this.getSelectedItems=function(){return N.board.find(".RenderedItem").filter((function(){return-1!=$.inArray($(this).data("itemData").id,N.selectedItems)}))},this.parentItemType=function(e){return/^Radio/.test(e)?"Radio":/^List/.test(e)?"List":/^Binary/.test(e)?"Binary":/^Open/.test(e)?"Open":/^Rate/.test(e)?"Rate":e},this.showProperties=function(e){if(void 0===e&&(N.getSelectedItems().length>0?1==N.getSelectedItems().length&&(e=N.getSelectedItems()[0]):N.hideProperties()),void 0!==$(e).data("itemData")){var t=$(e).data("itemData"),i=t.itemType,n=($(e).data("widget"),N.parentItemType(i)),o=$("#Properties").children(".Fields").empty(),a="Matrix"==i||"Group"==i||"Label"==i;new M.button({id:"DisplayRulesSelector",container:o,label:g.PROPERTIES_DISPLAY_RULES,text:t.visibility.rules.length>0?tr(g.PROPERTIES_DISPLAY_RULES_EDIT,t.visibility.rules.length):g.PROPERTIES_DISPLAY_RULES_ADD,options:O,command:N.handleEditDisplayRules,class:a?"NoLayout":void 0,texturePositionY:-447}),a||new M.selector({id:"LayoutSelector",container:o,options:L,label:g.PROPERTIES_LAYOUT,command:N.handleLayoutSelect}).setValue(t.layout,{skipEvents:!0}),"Open"==n&&(new M.selector({id:"TextValidator",container:o,options:L,label:g.PROPERTIES_VALIDATOR,command:N.handleLayoutSelect}),new M.selector({id:"SizeSelector",container:o,options:"OpenMultipleLine"!=i?w:_,command:N.handleChangeSize}).setValue(t.open.size,{skipEvents:!0})),a||new M.checkbox({id:"RequiredItem",container:o,label:g.PROPERTIES_REQUIRED,command:N.handleRequired}).setValue(t.required,{skipEvents:!0}),"Radio"==n||"List"==n||"Binary"==n?(new M.selector({id:"OrientationSelector",container:o,options:x,command:N.handleOrientationSelect}).setValue(t.orientation,{skipEvents:!0}),"Radio"==n&&new M.checkbox({id:"HasOther",container:o,label:g.PROPERTIES_HAS_OTHER,command:N.handleHasOther}).setValue(t.choice.other.show,{skipEvents:!0})):"Rate"==n&&(new M.selector({id:"HeaderStyleSelector",container:o,options:D,command:N.handleHeaderStyleSelect}).setValue(t.rate.headerStyle,{skipEvents:!0}),new M.spinner({id:"NumberOfValues",container:o,label:g.PROPERTIES_NUMBER_OF_GROUPS,command:N.handleChangeRateScale,minValue:1,zeroIsUnlimeted:!1}).setValue(t.rate.levels,{skipEvents:!0})),"List"==n&&new M.checkbox({id:"EnableMultiSelect",container:o,label:g.PROPERTIES_MULTISELECT,command:N.handleChoiceMultiSelect}).setValue(t.choice.multiSelect,{skipEvents:!0}),"Binary"==n&&new M.checkbox({id:"EnableBinaryIcon",container:o,label:g.PROPERTIES_SHOW_ICON,command:N.handleShowHideBinaryIcon}).setValue(t.choice.showIcon,{skipEvents:!0}),$("#Properties").fadeIn(100)}else N.board.find(".RenderedItem").length>0&&N.selectItem(N.board.find(".RenderedItem").last())},this.getParentItemId=function(e){var t=$(e).parents(".RenderedItem",".RenderedItem").first();return t.hasClass("RenderedItem")?t.data("itemData").id:"0"},this.hideProperties=function(){$("#Properties").fadeOut(150)},this.getTableCell=function(e,t){return null==t&&(t=e.order),"0"!=e.parentItemId?N.board.find("#RenderedItem"+e.parentItemId).children(".Item").children("table").children("tbody").children("tr").eq(e.cell.y).children("td").eq(e.cell.x).find(".SurveyInsert").eq(t):N.board.children(".SurveyInsert").eq(t)},this.getItemCell=function(e){var t={x:0,y:0};if($(e).parents(".RenderedItem").size()>0){var i=$(e).parent();t.x=i.parent().children().index(i);var n=i.parent();t.y=n.parent().children().index(n)}return t},this.setEditableLabel=function(e,t){var i=e.html();e.empty();var n=e.prepend('<textarea class="LabelEdition">'+i+"</textarea>");n.find("textarea").focus(),n.on("focusout",(function(t){var i=$(this).find("textarea").val();e.empty,e.html(i)})),n.find("textarea").on("click",(function(e){e.stopPropagation()}))},this.unsetEditableLabel=function(){$("textarea.LabelEdition").each((function(e,t){var i=$(t).parent(),n=$(this).val();i.empty,i.html(n)}))},this.remove=function(){$.each(N.getSelectedItems(),(function(){N.removeItem(this)}))},this.updateSurveyModel=function(){N.board.find(".RenderedItem").each((function(e,t){var i=$(t).data("itemData"),n=$(t).data("widget"),o=N.parentItemType(i.itemType);i.order=$(t).parent().children(".RenderedItem").index(t);var a=$(t).parents(".RenderedItem");a.size()>0?i.parentItemId=a.data("itemData").id:i.parentItemId=0,i.cell=N.getItemCell(t),i.label=$(this).find(".LabelItem .Label").html(),"Matrix"==i.itemType?i.matrix=n.getMatrixData():"Rate"==o&&(i.rate=n.getRateData()),i.choice.options=$(t).find("li.Option:not(.Header,.Other)").map((function(e,t){var n=[];return"RadioImage"==i.itemType||"ListImage"==i.itemType||"RateRadioImage"==i.itemType?n.push($(this).find(".Image").data("imgSrc")):"RadioVideo"!=i.itemType&&"ListVideo"!=i.itemType&&"RateRadioVideo"!=i.itemType||(n.push($(this).find(".Video").data("host")),n.push($(this).find(".Video").data("id"))),{label:$(this).find(".Legend").html(),value:$(this).find(".Value").text(),extra:n,order:e}})).get(),$(t).find("li.Option.Other").size()&&(i.choice.other.label=$(t).find("li.Option.Other .CellLabel").text(),i.choice.other.hint=$(t).find("li.Option.Other .OtherInput .Label").text()),"Open"==o&&(i.open.defaultText=n.getValue()),$(t).data("itemData",i)}))},this.getItemByIdFromModel=function(e,t){var i=-1;return $(e.items).each((function(e){this.id==t&&(i=e)})),i>=0?e.items[i]:void 0},this.getSurvey=function(){N.updateSurveyModel();var e={title:"No title"};return N.dialogs.surveySettings.hasChanged&&(e.settings=$.extend(!0,{},N.dialogs.surveySettings.settingsState)),e.items=$("#SurveyEdition .RenderedItem").map((function(e,t){return $.extend(!0,{},$(t).data("itemData"))})).get(),e};var n=this;$.each(["swapItems","moveItem","insertItem","remove","cut","paste","replace","handleReplaceRules","handleChangeItemType","handleOrientationSelect","handleHeaderStyleSelect","handleChangeSize","handleChoiceMultiSelect","handleRequired","handleShowHideBinaryIcon","handleChangeRateScale","handleHasOther","handleLayoutSelect"],(function(){n.registerMethodForUndoOperation(this)})),this.ui=new function(){var e=this,i=function(){return{beforeChange:N.storeCurrentState,change:N.addUndoOperation,sortComplete:function(){N.addUndoOperation(!0)},update:N.addUndoOperation,addOption:N.addUndoOperation}},n=function(){return{beforeChange:function(){N.storeCurrentState()},change:function(){N.addUndoOperation(!0)}}};this.base=function(e){var t;t="Top"!==e.layout?'<div class="LabelContainer"></div><div class="UIElement"></div>':'<div class="UIElement"></div><div class="LabelContainer"></div>',this.item=$('<div class="ElementStart"></div>'+t).prependTo(e.container),new M.inlineEdit({container:this.item.filter(".LabelContainer"),label:e.label,events:n()})},this.label=function(e){var t=$.extend({container:$("body"),label:g.LABEL_DEFAULT,events:n()},e);$.extend(this,new M.inlineEdit(t))},this.choice=function(t){$.extend(this,new e.base(t))},this.dropDown=function(t){t=$.extend({container:$("body"),label:g.LABEL_DEFAULT,events:i()},t),$.extend(this,new e.choice(t));var n=this,o=new M.dropDownEditable({container:this.item.filter(".UIElement"),containerClickCommand:function(){N.selectItem(n.item.closest(".RenderedItem"))},options:t.options,events:t.events});0==t.options.length&&o.convertOptionToEditableOption(o.createOption())},this.listChoice=function(t){var n,o;t=$.extend({container:$("body"),type:"RadioText",label:g.LABEL_DEFAULT,events:i()},t),$.extend(this,new e.choice(t)),t.type.match(/Binary/)?n=new M.listChoice({type:t.type,container:this.item.filter(".UIElement"),options:t.options,showIcon:t.showIcon,other:t}):(n=new M.listChoiceEditable({type:t.type,container:this.item.filter(".UIElement"),options:t.options,other:t.other,events:t.events}),0==t.options.length&&("ListCheck"==t.type&&(o={value:"True"}),n.convertOptionToEditableOption(n.createOption(o)))),this.widget=n},this.open=function(t){t=$.extend({container:$("body"),label:g.LABEL_DEFAULT},t),$.extend(this,new e.base(t));var i=this;this.getValue=function(){return i.widget.getValue()},this.widget=new M.openEndedEditable({type:t.type,container:this.item.filter(".UIElement"),open:t.open,defaultText:g.OPEN_DEFAULT_TEXT})},this.rank=function(t){t=$.extend({container:$("body"),options:[],label:g.LABEL_DEFAULT},t),$.extend(this,new e.base(t)),this.widget=new M.rankEditable({type:t.type,levels:t.levels,headerStyle:t.headerStyle,headerLabels:t.headerLabels,headerCategory:t.headerCategory,container:this.item.filter(".UIElement"),options:t.options,events:i()}),0==t.options.length&&this.widget.convertOptionToEditableOption(this.widget.createOption())},this.matrix=function(e){var i=$.extend({container:$("body"),rows:2,cols:2,widths:[{dimension:50,unit:"Percent"},{dimension:50,unit:"Percent"}],showToolbars:!0},e),n=this;this.table,this.latestUnit=R[0].value,this.operationsBar=function(){var e=this;this.currentCell={},this.getDisplayCell=function(e){var t={};return t.rowOperations=n.table.children("tbody").children("tr").eq(e.y).children("td").eq(0),t.columnOperations=n.table.children("tbody").children("tr").eq(0).children("td").eq(e.x),t},this.handleShowBar=function(t){e.currentCell=$(this).getCellIndexes();var i=e.getDisplayCell(e.currentCell);t.stopPropagation(),$(".RowMenu").hide(),$(".ColumnMenu").hide(),$(".MatrixRow").removeClass("HighlightRow"),n.getRows().eq(e.currentCell.y).addClass("HighlightRow");var a=n.table.children("tbody").children("tr").first().children("td").eq(e.currentCell.x).data("cellDimension");null!=a?(e.fields.cellWidth.setValue(a.dimension,{skipEvents:!0}),e.fields.widthUnits.setValue(a.unit,{skipEvents:!0})):e.fields.cellWidth.setValue(0,{skipEvents:!0}),o.show().position({my:"right top",at:"left top",of:i.rowOperations}),l.show().position({my:"left bottom",at:"left top",of:i.columnOperations})},this.handleHideBar=function(e){o.hide(),l.hide()},this.addRowUpHandler=function(t){n.addRow(e.currentCell.y),e.currentCell.y++},this.addRowDownHandler=function(t){n.addRow(e.currentCell.y,!0)},this.addColumnLeftHandler=function(t){n.addColumn(e.currentCell.x),e.currentCell.x++},this.addColumnRightHandler=function(t){n.addColumn(e.currentCell.x,!0)},this.deleteRowHandler=function(t){n.deleteRow(e.currentCell.y)},this.deleteColumnHandler=function(t){n.deleteColumn(e.currentCell.x)},this.moveRowUpHandler=function(t){n.moveRow(e.currentCell.y,!0),e.currentCell.y>0?e.currentCell.y--:e.currentCell.y=n.table.children("tbody").children("tr").size()-1},this.moveRowDownHandler=function(t){n.moveRow(e.currentCell.y,!1),e.currentCell.y=(e.currentCell.y+1)%n.table.children("tbody").children("tr").size()},this.moveColumnLeftHandler=function(t){n.moveColumn(e.currentCell.x,!0),e.currentCell.x>0?e.currentCell.x--:e.currentCell.x=n.table.children("tbody").children("tr").first().children("td").size()-1},this.moveColumnRightHandler=function(t){n.moveColumn(e.currentCell.x,!1),e.currentCell.x=(e.currentCell.x+1)%n.table.children("tbody").children("tr").first().children("td").size()},this.changeColumnWidthHandler=function(t){var i=e.fields.cellWidth.getValue(),o=e.fields.widthUnits.getValue(),a=(e.fields.widthUnits.getValue(),n.table.children("tbody").children("tr").first().children("td").eq(e.currentCell.x));"Percent"!=o?n.table.css({width:"auto"}):n.table.css({width:"100%"}),a.data("cellDimension").dimension=i,n.latestUnit=o,n.table.children("tbody").children("tr").first().children("td").data("cellDimension").unit=o,n.refreshWidths()};var o=$('<div class="RowMenu"></div>').appendTo(i.container);this.rowMenu=o;var a=$('<div class="LeftMenu"></div>').appendTo(o);$('<div class="Operation Move Up Icon Iconset"></div>').appendTo(a).on("click",this.moveRowUpHandler),$('<div class="Operation AddRow Up Icon Iconset"></div>').appendTo(a).on("click",this.addRowUpHandler),$('<div class="Operation Delete Icon Iconset"></div>').appendTo(a).on("click",this.deleteRowHandler),$('<div class="Operation AddRow Down Icon Iconset"></div>').appendTo(a).on("click",this.addRowDownHandler),$('<div class="Operation Move Down Icon Iconset"></div>').appendTo(a).on("click",this.moveRowDownHandler);var l=$('<div class="ColumnMenu"></div>').appendTo(i.container);this.columnMenu=l;var s=$('<div class="TopMenu"><table class="InvisibleTable"><tr></tr></table></div>').appendTo(l).find("tr");$('<td><div class="Operation Move Left Icon Iconset"></div></td>').appendTo(s).on("click",this.moveColumnLeftHandler),$('<td><div class="Operation AddColumn Left Icon Iconset"></div></td>').appendTo(s).on("click",this.addColumnLeftHandler),$('<td><div class="Operation Delete Icon Iconset"></div></td>').appendTo(s).on("click",this.deleteColumnHandler),$('<td><div class="Operation AddColumn Right Icon Iconset"></div></td>').appendTo(s).on("click",this.addColumnRightHandler),$('<td><div class="Operation Move Right Icon Iconset"></div></td>').appendTo(s).on("click",this.moveColumnRightHandler);var d=$('<td class="WidthLabel">'+g.WIDTH+'</td><td><div class="CellWidth"></div></td>').appendTo(s).find(".CellWidth");e.fields={},e.fields.cellWidth=new M.spinner({container:d,minValue:0,zeroLabel:g.WIDTH_AUTO});var r=$('<td><div class="CellUnits"></div></td>').appendTo(s).find(".CellUnits");e.fields.widthUnits=new M.selector({container:r,options:R,command:e.changeColumnWidthHandler}),e.fields.cellWidth.item.find("input").on({change:e.changeColumnWidthHandler,keyup:e.changeColumnWidthHandler}),n.table.parentsUntil(".RenderedItem").on("mouseover",t.stopPropagation)},this.addRow=function(e,t){N.addUndoOperation();var i=n.table.children("tbody").children().eq(e),o=$('<tr class="MatrixRow"></tr>');t?o.insertAfter(i):o.insertBefore(i),$.each(i.children(),(function(){var e=$('<td class="MatrixCell"></td>').appendTo(o);n.initCell(e),e.delay(500).addClass("Highlight",500).delay(1e3).removeClass("Highlight",500)}))},this.moveRow=function(e,t){N.addUndoOperation();var i=n.table.children("tbody").children("tr");t?e>0?i.eq(e).detach().insertBefore(i.eq(e-1)):i.eq(e).detach().insertAfter(i.last()):e<i.size()-1?i.eq(e).detach().insertAfter(i.eq(e+1)):i.eq(e).detach().insertBefore(i.first())},this.addColumn=function(e,t){N.addUndoOperation(),n.table.children("tbody").children("tr").each((function(){var i=$('<td class="MatrixCell"></td>');t?i.insertAfter($(this).children("td").eq(e)):i.insertBefore($(this).children("td").eq(e)),n.initCell(i),i.delay(500).addClass("Highlight",500).delay(1e3).removeClass("Highlight",500)}))},this.moveColumn=function(e,t){N.addUndoOperation(),n.table.children("tbody").children("tr").each((function(){var i=$(this).children("td");t?e>0?i.eq(e).detach().insertBefore(i.eq(e-1)):i.eq(e).insertAfter(i.last()):e<i.size()-1?i.eq(e).detach().insertAfter(i.eq(e+1)):i.eq(e).insertBefore(i.first())}))},this.deleteRow=function(e){N.addUndoOperation(),n.table.children("tbody").children("tr").eq(e).remove()},this.deleteColumn=function(e){N.addUndoOperation(),n.table.children("tbody").children("tr").each((function(){$(this).children("td").eq(e).remove()}))},this.initCell=function(e){N.createInsert(e,!0),e.on({mouseover:n.operationsBar.handleShowBar}).data("cellDimension",{dimension:0,unit:n.latestUnit})},this.refreshWidths=function(e){e=$.extend({animate:!0},e),n.table.children("tbody").children("tr").first().children("td").each((function(e){var t=$(this).data("cellDimension"),i=$(R).filter((function(){return this.value==t.unit})).get(0).label,n={width:t.dimension>0?t.dimension+""+i:"auto"};$(this).css(n)}))},this.setColumnCount=function(e){var t=n.getColumnCount()-e;t>0?n.getRows().each((function(){$(this).children().slice(e).remove()})):t<0&&n.getRows().each((function(){for(var e=t;e<0;++e){var i=$('<td class="MatrixCell"></td>').appendTo(this);n.initCell(i)}}))},this.setRowCount=function(e){var t=n.getRowCount()-e;if(t>0)n.getRows().slice(e).remove();else{for(var i=$('<tr class="MatrixRow"></tr>'),o=n.getColumnCount(),a=0;a<o;++a){var l=$('<td class="MatrixCell"></td>').appendTo(i);n.initCell(l)}for(a=t;a<0;++a)n.table.children("tbody").append(i.clone(!0))}},this.getRows=function(){return n.table.children("tbody").children("tr")},this.getColumns=function(e){return e.children()},this.getRowCount=function(){return n.getRows().size()},this.getColumnCount=function(){return n.getColumns(n.getRows().eq(0)).size()},this.getCell=function(e,t){return n.getColumns(n.getRows().eq(e)).eq(t)},this.getMatrixData=function(){return{rows:n.table.children("tbody").children("tr").size(),cols:n.table.children("tbody").children("tr").first().children("td").size(),widths:n.table.children("tbody").children("tr").first().children("td").map((function(){return $(this).data("cellDimension")})).get()}};var o=$('<table class="MatrixTable"></table>').appendTo(i.container);this.table=o,1==i.showToolbars&&(this.operationsBar=new this.operationsBar);for(var a=0;a<i.rows;++a)for(var l=$('<tr class="MatrixRow"></tr>').appendTo(o),s=0;s<i.cols;++s){var d=$('<td class="MatrixCell"></td>').appendTo(l);this.initCell(d)}$.each(i.widths,(function(e){o.children("tbody").children("tr").first().children("td").eq(e).data("cellDimension",this)})),n.refreshWidths()}}}return t})()}));